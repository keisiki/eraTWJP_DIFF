2018年時点で終了していたのは
潜伏場所.ERH
潜伏場所決定処理.ERB
潜伏場所文字列呼び出し.ERB
のみ

潜伏率関連処理が稼動しないことを解決できないままになっている
最優先でこれを稼動させる

1,潜伏率増減処理における戦闘技能補正関連の計算をごっそりオミット
理由,潜伏率増減処理を稼動させるため
結果,稼動せず

2,「潜伏率の増減処理」の呼び出しをINFOからSOUSEへ移動
理由,潜伏率増減処理を稼動させるため
結果,稼動せず

3,潜伏率増減処理における計算方式を変更。LOCALに+-して最終増減値を決定する方式から直接増減方式へ
理由,潜伏率増減処理を稼動させるため。1の変更により最終増減値自体が不要になった
結果,稼動せず

4,潜伏率増減処理中の分岐構文IF GET_TARGETNUM() < 1をIF GET_TARGETNUM() > 1に変更
理由,潜伏率増減処理を稼動させるため。変更前の構文だと自分しかいないときにしか働かないよね
結果,潜伏率増減処理が稼動。全ては凡ミス…

ここから探知・会話モード実装試行BITver

5,潜伏率の増減処理に潜伏・探索モードと会話モードの分岐を作成
理由,増減値に差をつけるため

6,探知モードの探知者を決定する処理を追加、1500以上のキャラが潜伏率50％以下で探知者に
備考,FOR構文は話者決定から流用

7,探知モードの探知判定を追加

8,会話モード継続判定を追加

9,潜伏モード終了処理判定を独立
理由,リセットすべき変数の増加

10,潜伏率の増減処理に各モード独立した変数を
理由,判定関係の処理が混線しないように


11,COMMON.ERB,859行目を書き換え
FLAG:潜伏 = 0 →　CALL 潜伏モード終了処理
理由,潜伏モード終了処理を追加したため

12,TFLAG:探知試行回数、会話回数を追加
理由,#DIMじゃ無理だった

13,上記変更にあわせて10で追加した変数全てに変更
#DIM関係をTFLAGに

14,678で使用していたFOR構文からDETCTOR,TOKERに関係する記述の削除
理由,参照先が見つからないエラーが発生。精査した結果無くても直接LOCALにCFLAGを投げれば良さそう

15,上記変更にあわせてLOCALにCFLAGをつける形に記述を変更
結果,エラーは解消するものの各処理が想定どおりの動きをしていないことが判明

16,各CFLAG:ARG:潜伏状態に対する変更及び検索にSETBIT、GETBITを記述
理由,こうしないとBITを正しく認識できないんじゃないかな？
結果,ダメ

BITの仕様そのものを確認する
BITは一つの数字が切り替わっていくのではなくA,B,C,Dのそれぞれをオンオフしているだけ

ここから探知・会話モード実装試行ver2

17,上記までを探知・会話モード実装試行BITverとして保存。新たなファイルに
理由,前verが結果的に使える可能性もある。こちらの方はフラグを多数使う可能性大

18,いままで0代入でオフにしようとしていたところをCLEARBITに変更
理由,こうしないとオフにならない

19,FLAG:潜伏、CFLAG:潜伏状態を(0=なし1=潜伏2=探知3=会話)から(0=潜伏1=探知2=会話)に変更
理由,0をあける意味がなくなった

20,上記変更に則って記述を変更
結果,モード切替の実装に成功

ここから探知・会話モード実装

21,"探知"を"探索"へ変更
理由,より正確な表現とするため

22,潜伏描写などに潜伏率とモードに応じて色変更する機能を追加

23,探索者や会話者を求める処理を6のFOR構文からIN＿ROOM＿MEMBERを利用する形へ変更

24,物陰に誘うの条件を変更
理由,わざわざデートに誘う意味はない。またターゲット無しでは実行不可に

25,22で行った色変更機能をより細かく変わる様に調整。同時に構文のテンプレを変更する。
理由,モードと潜伏率の区別がつきやすくなる。テンプレは情景描写を二行目に追加する前提の形に変更

26,物陰に誘うの条件を変更
理由,潜伏モード中に新たに物陰に連れ込んだり出来たのを修正

27,外出先から帰宅、連れ出す、部屋を訪ねるなど一部コマンドを潜伏モード中できないように
理由,潜伏モードの中断や強制終了に繋がる

28,通常プレイに支障なし。一部未完成だがこれで一度上げる事にする。
理由,助言と意見が欲しい