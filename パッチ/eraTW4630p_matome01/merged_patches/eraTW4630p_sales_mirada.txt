2018/08/31
eraTW4.630proto用ミラダの石訪問販売デイリーパッチ

・ミラダの石訪問販売デイリーの実装
・適宜リファクタリング



◆対象環境
eraTW4.630protoのバニラ環境

以下のパッチはマージ済み

[eraT0010724]eraTW4.630proto用外出マップ正邪宅追加他パッチ
	キャラ番号直打ちから_Rename.csvを利用して可読性を上げてるのはぜひ他の人にも広めたい
	目についた所だけでも少しずつ修正しておきたいです
[eraT0010726]eraTW4.630proto用パンツとブラ処理改変+αパッチ
	ブラジャー処理での総当たり分岐直打ち指定から
	各パンツ側にコーディネートするブラの情報を持たせるリファクタリングがとてもよい
	適当に改良しときました
	・MAKE_INTしなければ0が返るのでノーブラはそれでよし
	・衣装セット.ERBで使用している@CLOTHES_ID関数を使えば装備部位と衣服名称を使って衣服が指定できます
		コメントなしでもどのブラが対応してるのかわかるようになります
		CALLF MAKE_INT(V_NAME, 10)
			↓
		CALLF MAKE_INT(V_NAME, CLOTHES_ID("上半身下着１", "Ｔシャツ"))
	・ついでに@今日のブラジャーにてノーブラが発生するように仕込むなど、夏はノーブラ率上がります
	　その他、ヤリマン時空（全員ヤリマンモード）だと安易にエロくなります
	　とりあえず非ヤリマン時空において、ニューゲームで1日に1キャラ程度はノーブラの娘が発生するくらいの確率
	・ブラジャー抽選に確率系を織り交ぜた結果、途中でブラの種類が変わるようになるバグが出た
	　ぱんつと同じ要領で、今日のブラ、パジャマ用ブラを抽選するように処理を組みました
	　@今日のブラジャーはF関数化



◆内容
・248スレ>>494、ラルバ、舞、里乃、隠岐奈のよく行く地域を暫定で-1に設定
　@遭遇判定はちゃんと読んでいないから内容把握してない
　口上修正はやってない
・既存デイリー系の微妙なリファクタリング
・副産物として、拠点マップのYOGORE値合計と平均を取れるF関数をCOMMONに入れた
・ITEM獲得とそのアナウンスができる関数を作ってCOMMONに入れた
　IDと取得個数を渡して使います
　使ってみたらとても便利なので円とカリスマの入手と支払い用の関数も用意しときました
　既存の処理の置き換えはとりあえず、デイリー系と依頼系だけやってみた
・ミラダの石訪問販売デイリーの実装
　一発ネタのインパクト勝負
　音の出ないeraでうるせぇ！と思ってもらえれば大成功
　ただし現状ではエロはほぼ無いよ
　最初の選択肢で訪問販売お断りすると以後来訪しません
・夢精デイリーで稀にミラダの石が入手できるように
・HPH_PRINT関数で使ってるcolorをC_H_PINKとして広域定義しました
　HEARTMARK関数で使ってるcolorが微妙に違う色だったのでC_H_PINKに揃えました
　C_H_PINKはいい感じに使いやすいピンク色ではないかなと思います
　C_PINKは色が薄すぎて通常色と見分けがつきにくく、C_D_PINKはちょっと毒々しい
・ブラ関連の諸々の変更
　衣装関連でまたバグでるかも……



◆出てた意見の拾い直しなど
>「神社の方から来たんですけど～愛欲を独占する～」　悪質押し売り訪問販売パターン
>てゐちゃんから買う
セールスは実装しました
なんつーかモブ兎娘のクセに無闇にキャラが立ってしまったねぇ？
脳内設定的にはてゐちゃんと同じような服装、貧乳（まな板ではない）、Ｂ敏感
深く掘り下げて考えてるわけではありません


>畑で掘り当てる
>釣る
>あなたはギターを弾いてみた　ｺﾞｯ　　el○na的投石が実はパターン
つくるのは簡単そうだけどとりあえず各コマンドの拡張はパス
１．畑は農民専用になっちゃうけどいいのかな？一日一回のコマンドってのは入手頻度を調整しやすいかも？
２．釣りは拡張を見越した作りになってて実装は楽なはず
３．演奏に関しては報酬とか設定しだすと面倒だと思う（現時点では影も形もないので）
余談ですが演奏系は別方向（フレーバー方面、好感度系の実績？）としての拡張案を考えてます


>店で買った綺麗な石が実は　パターン
これは実装しにくい
「雑多な商品が置いてあって売買が可能な店」がない


>もみもみ「ここほれワンワン」　飼い犬が見つける
これは描写を工夫すればデイリーとして実装できる
「いつの間にうちのあなたは犬を飼ってたんだYO!!」は避けなければ
　地霊殿（犬その他動物各種）、華扇屋敷（動物各種）、永遠亭（妖怪兎）、紅魔館（妖精メイド）
　聖徳道場（門下生）、命蓮寺（檀家）、守谷神社（信者）、白玉楼（幽霊・未実装）
各拠点のそれっぽいモブが偶然拾ってくるイベントをつくる？
陥落済みの同居キャラを参加させてもいいかもね
石コレクションしてるのってわかさぎ姫だっけか


>謎の存在から授かる「石が欲しいか･･････」　パターン
代償がありそうでこえーよｗ


>セフレを孕ませると、パンツを履く者が増えた報酬にパンツ神から貰える
孕ませ限定にするよりは年始に決める方針ごとに条件を満たすと石をもらえるとか？


>ミラダの苗
元が高額アイテムだから調整が難しそう
ローターとの価格比較で検討するとわかるが
例）価格が10倍だから入手頻度を1/10にしたい→栽培日数を10倍
とかするとダルくなるし、かといって苗を高額にすると結局入手は容易にならなくて意味が薄い
確率に頼る方向でランダムアイテム入手系の苗という選択肢が有力だろうか


>お姉ちゃんから出てくる
苦痛刻印つくのはやめましょう


>スロットで1/8192で「ミ」「ラ」「ダ」が出現
ごめん
スロットまわりはちと手に負えない


>願掛けによりお腹の中の子供がミラダの石に変化する（母親は出産時に【狂気】付与）
>ひとり立ちした娘からビデオレター（意味深）と一緒に届く（母親に【狂気】付与）
そこはほら、にゃんにゃんの固有コマンド実装じゃない？
こわいから絶対に作らないけど



>採掘要素入れようぜ
>そこでミダラの石か低確率で手に入るんだ
morphの貧弱な脳みそでは地底の炭鉱での過酷な日雇労働生活くらいにしかそのアイディアは膨らませられない
でも幻想郷は石炭が活用されるようなスチームパンクな空間ではないと思うんだ
まー、金鉱とかでもなんでもいいけど
その場合でもミラダの石はあくまでも付随要素であってメインの何かが別に必要になるよね



◆その他
・メインのパッチの改造部分よりも衣装関連いじるほうがしんどかった
・ついでに環境を変えたせいでtabが半角スペースになってて焦った
・SETCOLOR周りの処理を整理しようとしたが挫折した
・固有下着関連のエラーは直してない
・やっぱエロ書くの難しいや
・演奏拡張するかも（フレーバー方面）
　内容は大体考えた
・TALENT:淫乱の使用箇所
　TWにはTALENT:淫乱の取得処理は存在しない
　……しかし、唯一、ナズーリンのみが口上独自処理で淫乱を取得できてしまうのであった
　寺に住んでるくせに全然煩悩を克服できてないじゃないか
　なんだこのエロネズミは（大好きです）
　口上作者の意図としてはフレーバーらしいが、SOURCEに補正が入るので完全なフレーバーにはならない
　
　":淫乱"の使用箇所のうち、下着関連に仕込んだのはmorphである
　毎度すんません
　下着に関してはとりあえずセフレによる判定に変えておきました
　他はcom系とsource関連が大半なはず、微妙に口上で使ってる箇所もある
・@CHARAMOVE_DATA系をキャラデータ関数に移植したくなってきた
　引数の数からして現実的に可能なはず
　作業の量からして現実的につらいはず



◆つくったひと：morph
・morphのつくった以外のところの扱いはつくったひとに聞いて下さい
・配布・改造・流用、好きにしてください
・でも、その際のサポートは自分でやってね

※　era＝R-18全般の常識的な取り扱いとして例えば以下のような事はやめて下さい

・未成年者がいっぱいいる場所で広める
・R-18以外のモノをメインに扱ってる場所で取り上げる
