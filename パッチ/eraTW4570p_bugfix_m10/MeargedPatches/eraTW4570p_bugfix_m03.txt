2017/12/08
eraTW4.570proto用バグ修正3

◆説明
COM400のばぐふぃっくす
妖怪の山山頂マップでの移動先の選択における地点ID811-813のシステムコマンドとの干渉を修正しました
現状でのバグ修正は全部取り込みました

古い記述のリファクタリングを含み、バグを発生させている可能性があります
移動コマンドでの挙動の報告をもとむ



◆対象環境
本体：[eraT0010318]eraTW4.570proto

eraTW4.570protoのバニラ環境、もしくは以下のパッチのみを適用している場合には
そのまま上書きが可能です（変更内容をマージしてあります）
これ以外のパッチとの相性は不明

・[eraT0010318]eraTW4.570proto用バグ修正
・[eraT0010320]eraTW4.570proto用乳首吸い継続バグ修正+α
・[eraT0010324]eraTW4.570proto用バグ修正2＋α
・[eraT0010325]eraTW4.570proto用美鈴csv修正+一括処理挙動変更

※　[eraT0010325]について
とりあえずめーりんのcsv修正だけもらうことにした
一括処理挙動の変更を適用しない理由はスレにも書いたとおり
これをやると明示的なアナウンス無しでキャラ初期化処理が入るためプレイヤーに挙動がわかりにくくなるため
「動物耳化→一括処女化→一括非処女化→動物耳つけたつもりが一人もついてない」とか発生しそう



◆変更点
@COM400
・STRとの比較を行うFOR-NEXTが不要っぽいので消した
　ちゅーか、博麗神社マップでしか動かない≒かなり古い設計？？？
・811-813の番号かぶりは迷った挙句にZ, X, Cに割り振ることにした
　本当はINPUTSをINPUTにしたかった
　マップ描画等、外部関数でのボタン処理は数値しかINPUTされず、INPUTでも支障はないようです
　番号を9001とかにしておけば拠点マップ実装による地点の増加は気にしなくていい
　でもあんま大きな数字にするのもなぁ
　INPUTS使えばSTR入力でいけるしこれでいいじゃんとなった
　いずれにせよUSERCOM側との数字の対応は崩れるんだし
　
　どうせやるならマップ切り替え/察知モード切り替えもA,Sとかに割り振ればよかったかもしれん
　システム系は全部アルファベットに割り振っちゃう、一貫性があったほうが使いやすい
　でもこれ、変えたところでテンキープレイヤーにしか関係ないよね
・移動先の入力1～99を「MAIN_MAP * 100 + 1～99」として扱うように
　テンキー入力でやってる自分用に実装
　博麗神社以外に在住している時に便利なのです
・この関数内でのTSPの減少や時間の経過はおそらく動いてないはずなのでその点をコメントで明記した
・コメントアウトされてる隠密処理とあわせて、削除しても問題なさそう？
　ここらへんは断言できないのがくるしいところ

@CAN_MOVE_8(ARG, ARG:1)
・811:境内→818:諏訪子私室の接続を削除し、811:境内→822:台所に変更
　たぶんこれが正しいであろう
　テストプレイ中に発見し、山頂マップの接続は一通り見なおした



◆つくったひと：morph
・morphのつくった以外のところの扱いはつくったひとに聞いて下さい
・配布・改造・流用、好きにしてください
・でも、その際のサポートは自分でやってね

※　era＝R-18全般の常識的な取り扱いとして例えば以下のような事はやめて下さい

・未成年者がいっぱいいる場所で広める
・R-18以外のモノをメインに扱ってる場所で取り上げる
