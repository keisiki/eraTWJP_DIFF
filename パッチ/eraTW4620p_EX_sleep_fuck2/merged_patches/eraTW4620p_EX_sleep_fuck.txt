2018/07/19

前に言ってた睡眠姦強化パッチ

バニラ環境での睡眠深度は睡眠薬を使うか時間経過でしか加算されなかったため
日中の行動で蓄積するTCVAR:疲労度を追加
入眠直後の睡眠深度を増加

ついでにバグフィックス



◆対象環境
eraTW4.620protoのバニラ環境
また、以下のパッチはマージ済み

>>363[eraT0010645]　eraTW4.620proto色々修正＋α
>>379[eraT0010647]　eraTW4.620proto用実績修正改良パッチ
>>452[eraT0010652]　eraTW4.620proto用実績修正改良パッチ修正版
>>469[eraT0010654]　eraTW4.620proto用Renameその他修正パッチ
>>507[eraT0010655]　eraTW4.620proto用実績修正改良パッチ修正版２

これら以外のパッチとの競合は不明



◆内容
・TCVAR:疲労度の追加、DOWNBASE依存の睡眠深度の加算処理用
よーするにera命蓮寺ODであったアレだ（あっちのerbは参考にしてないが）
日中疲れることを沢山すると疲労度が溜まり睡眠深度が上がる
睡眠中は徐々に睡眠深度に変換されて減っていき、起床時に0になる
実装したはいいがTARGETのDOWNBASE使うCOMが思ったより少ない
戦闘訓練とお仕事でくらいしか使い物にならんかも

・酒気の影響
疲労度同様に睡眠深度に加算されるように変更

・睡眠薬の処理変更
バニラ環境の関数@BASE自然変動の挙動では
起きている時は睡眠深度が減少し、入眠後に時間経過に伴って睡眠深度が増加していく
結果として、TARGETが自然に睡眠についた直後では睡眠深度が全然稼げなかった
入眠時に睡眠薬強度を参照して最低保証をつけることにした
全体的に睡眠深度を稼ぐ手段がなく、昏睡以外を選ぶ場合のリスクが高くなりすぎていたと思う
起きるか起きないかのスリルを楽しむという面もあり、とりあえずケツに眠剤ぶちこむのが安定ってのは味気ない
ナチュラルにファックできるバランスがいい

・入眠のタイミングについて
入眠処理のタイミングを弄るのは色々としんどそうなので無理
	例）睡眠薬を飲むと30分後にはぐっすり
というような改造をする気はない
通常の処理に割り込んで睡眠を入れるのは諸々面倒でやりたくない

・@CHARA_SLEEPと@キャラ移動処理
WHILE処理が怪しかったので書き換えてみたんだがどうだろうか
仕様上、CHARANUM - 1のキャラが処理からスキップされる挙動になっていたが
これは想定した動作なのかどうか

・ついでに各種パッチマージ
・ついでににとりの固有依頼修正>>409
・ついでにshopの能力表示にて信頼度ソートが機能してなかったのも修正
・ついでに能力表示で仕事情報が動いてなかったのも修正
つーか、仕事関連のCSTR:1とONCE関数で使用しているCSTR:1が衝突してるのは根本的にどうにかしたほうがよさそう
今までは問題にならなかったがモブ娘はCSV参照できないから何か考えないといけない

・仕様覚書
COMMON.ERBでの仕様
	CSTR:0　@FIRSTTIMEにて使用
	CSTR:1　@ONCEにて使用、TRAIN開始時にリセットされ、実質的に一日一回の判定となる
CSV側での仕様
	CSTR:1　各chara.csvにて仕事の内容を提示、仕事内容をcsvで記述できないモブ娘が実装されたことで齟齬をきたしている
	CSTR:2　職場情報
仕事情報のCSTRをCSTR:1からCSTR:3にずらす手がよさそうだが全キャラ対象のアプデが必要



◆つくったひと：morph
・morphのつくった以外のところの扱いはつくったひとに聞いて下さい
・配布・改造・流用、好きにしてください
・でも、その際のサポートは自分でやってね

※　era＝R-18全般の常識的な取り扱いとして例えば以下のような事はやめて下さい

・未成年者がいっぱいいる場所で広める
・R-18以外のモノをメインに扱ってる場所で取り上げる
