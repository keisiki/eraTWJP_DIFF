;-----------------------------------------------------------
;MOB割当の覚書
;0～10	各地域土産物屋
;11		酒屋
;12		索道人里側
;13		鈴奈庵（小鈴不在時）
;14		人里温泉
;15		守谷くじ
;16		索道守谷側
;17		紅魔カジノ
;20		モブ男（CSVで割当)
;-----------------------------------------------------------
;モブ子作成の改変
@モブ店員画像作成(店員番号)
#DIMS 種族 = "赤巫女", "尼", "人妻", "メイド妖精", "イナバ", "妖精", "ゾンビフェアリー", "スク水河童", "白狼天狗", "鬼", "玉兎", "人妻", "人妻", "店番", "番台ちゃん", "緑巫女", "河童", "バニー妖精"
#DIM キャラ番号
#DIM GID
#DIMS 生成文字列
#DIMS 合成文字列配列, 50
#DIMS 色合成
#DIM 合成数
#DIM リソースカウント
#DIM 店員番号
種族:5 = %TEXTR("妖精/化け狸/化け猫/化け狐")%
CALL SET_MOB_IMAGE_STR(0, 種族:店員番号, 店員番号)
FOR リソースカウント, 0, 3
	;初期化
	GID = 0
	VARSET LOCAL
	VARSET 合成文字列配列,
	合成数 = 0
	;画像合成下地用のダミーを配置する
	CALL 画像合成(GID,"ダミー")
	;使うリソースの名称を配列に取得する
	SELECTCASE リソースカウント
		CASE 0
			CALL モブ子リソース探索(合成文字列配列, 合成数, モブ子店員画像文字列_服_通常:店員番号, 1)
		CASE 1
			CALL モブ子リソース探索(合成文字列配列, 合成数, モブ子店員画像文字列_服_笑顔:店員番号, 1)
		CASE 2
			CALL モブ子リソース探索(合成文字列配列, 合成数, モブ子店員画像文字列_服_怒り:店員番号, 1)
	ENDSELECT
	
	;モブ子画像は高い番号のリソースから先に合成していく必要があるので降順にソートする
	ARRAYSORT 合成文字列配列, BACK, 0, 合成数
	;モブ子用画像を順番に合成していく
	FOR LOCAL, 0, 合成数
		色合成 '= ""
		IF 合成文字列配列:LOCAL != ""
			;色合成確認
			FOR LOCAL:1, 0 ,モブ子素材色種別数
				SELECTCASE リソースカウント
					CASE 0
						IF STRFIND(合成文字列配列:LOCAL, @"_%モブ子素材色種別:(LOCAL:1)%_") != -1 && DIC_CONTAINSKEY(モブ子店員画像文字列_服_通常:店員番号, @"%モブ子素材色種別:(LOCAL:1)%色")
							色合成 = %DIC_GET(モブ子店員画像文字列_服_通常:店員番号, @"%モブ子素材色種別:(LOCAL:1)%色")%
							LOCAL:1 = モブ子素材色種別数
						ENDIF
					CASE 1
						IF STRFIND(合成文字列配列:LOCAL, @"_%モブ子素材色種別:(LOCAL:1)%_") != -1 && DIC_CONTAINSKEY(モブ子店員画像文字列_服_笑顔:店員番号, @"%モブ子素材色種別:(LOCAL:1)%色")
							色合成 = %DIC_GET(モブ子店員画像文字列_服_笑顔:店員番号, @"%モブ子素材色種別:(LOCAL:1)%色")%
							LOCAL:1 = モブ子素材色種別数
						ENDIF
					CASE 2
						IF STRFIND(合成文字列配列:LOCAL, @"_%モブ子素材色種別:(LOCAL:1)%_") != -1 && DIC_CONTAINSKEY(モブ子店員画像文字列_服_怒り:店員番号, @"%モブ子素材色種別:(LOCAL:1)%色")
							色合成 = %DIC_GET(モブ子店員画像文字列_服_怒り:店員番号, @"%モブ子素材色種別:(LOCAL:1)%色")%
							LOCAL:1 = モブ子素材色種別数
						ENDIF
				ENDSELECT
			NEXT
			CALL 画像合成(GID, 合成文字列配列:LOCAL, 0, 0, 0, 0, 色合成)
		ENDIF
	NEXT
	;汎用テンプレートで使用できるように名前を統一する
	SELECTCASE リソースカウント
		CASE 0
			CALL リソース登録(@"顔絵_服_通常_MOB_{店員番号}", GID)
		CASE 1
			CALL リソース登録(@"顔絵_服_笑顔_MOB_{店員番号}", GID)
		CASE 2
			CALL リソース登録(@"顔絵_服_怒り_MOB_{店員番号}", GID)
	ENDSELECT
NEXT
