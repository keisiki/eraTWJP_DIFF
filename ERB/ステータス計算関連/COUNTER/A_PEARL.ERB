@PEARL_CHK_MASTER
#DIM INSERTER
#DIM CONST INTERVAL = 30
#DIM KAKUNIN
#DIM LAPSE

SIF !TFLAG:パール期限
	RETURN

INSERTER = TFLAG:パール入れた人

;流石に他人がいるとチェックしない
KAKUNIN = 1
SIF CFLAG:INSERTER:現在位置 != CFLAG:MASTER:現在位置
	KAKUNIN = 0
SIF GET_TARGETNUM() > 1
	KAKUNIN = 0
SIF !SHIRAHU(INSERTER)
	KAKUNIN = 0

IF TFLAG:パール挿入個数
	SOURCE:MASTER:快Ａ += TIME_PROGRESS(TIME:1) * TFLAG:パール挿入個数
	SOURCE:MASTER:苦痛 += TIME_PROGRESS(TIME:1) * TFLAG:パール挿入個数 * 2
	DOWNBASE:MASTER:体力 += TIME_PROGRESS(TIME:1)
ENDIF

IF TFLAG:パール期限 < TIME && TFLAG:パール期限 > 0 && TFLAG:パール挿入個数
	PRINTFORML %CALLNAME:MASTER%は約束の時間まで耐え抜いた
	PRINTFORML %CALLNAME:INSERTER%に抜いてもらおう
	TFLAG:パール期限 = -1
ENDIF
IF KAKUNIN
	IF TFLAG:パール期限 == -1
		PRINTFORMW %CALLNAME:INSERTER%は期限まで我慢できた%CALLNAME:MASTER%の頭を撫でながら、アナルパールを一個ずつゆっくり引き抜いた
		CALL PEARL_EJECT("引っこ抜き")
		RETURN
	ELSEIF TFLAG:パール期限 == -2
		PRINTFORML アナルパールが抜けきっていたことに気づいた%CALLNAME:INSERTER%は、やり直し、と言ってまた1玉ずつ%CALLNAME:MASTER%の直腸に押し込んだ！
		CALL PEARL_INSERT(INSERTER,5)
	ENDIF
ENDIF

LAPSE = (TIME - TFLAG:パール排出チェック) / INTERVAL

IF LAPSE && TFLAG:パール期限 > 0
	TFLAG:パール排出チェック = TIME
	IF KAKUNIN
		PRINTFORML %CALLNAME:INSERTER%は%CALLNAME:MASTER%の尻に手をやり、アナルパールの状態を確認した…
		PRINTFORML %CALLNAME:MASTER%の尻穴からパールがぶら下がっているのを確かめると、%CALLNAME:INSERTER%は微笑んでリングを軽く引き、%CALLNAME:MASTER%にもう少し我慢するように言った…
		SOURCE:MASTER:快Ａ += 50
	ENDIF
	FOR LOCAL, 0, LAPSE
		CALL PEARL_PATIENCE
	NEXT
ENDIF

@PEARL_EJECT(ARGS)
#DIM INSERTER
#DIM OTOSIDAMA
INSERTER = TFLAG:パール入れた人

IF ARGS == "自然排出"
	SOURCE:MASTER:快Ａ += 100
	EXP:MASTER:Ａ経験 += 1
	TFLAG:パール挿入個数 -= 1
	PRINTFORMW アナルパールが1玉出てきてしまった（残り{TFLAG:パール挿入個数}玉）
	IF !TFLAG:パール挿入個数
		PRINTFORMW パールが抜けきってしまった…
		TFLAG:パール期限 = -2
	ENDIF
ELSEIF ARGS == "引っこ抜き"
	SOURCE:MASTER:快Ａ += TFLAG:パール挿入個数 * 200
	EXP:MASTER:Ａ経験 += TFLAG:パール挿入個数
	EXP:MASTER:苦痛快楽経験 += TFLAG:パール挿入個数 * 3
	EXP:INSERTER:嗜虐快楽経験 += TFLAG:パール挿入個数 * 3
	SOURCE:INSERTER:加虐 += TFLAG:パール挿入個数 * 100
	TFLAG:パール挿入個数 = 0
	TFLAG:パール期限 = 0
	TFLAG:パール入れた人 = 0
	TFLAG:パール排出チェック = 0
	IF FESTIVAL() == "元日"
		SELECTCASE RAND:3
			CASE 0
				OTOSIDAMA = 10000
			CASE 1
				OTOSIDAMA = 30000
			CASE 2
				OTOSIDAMA = 50000
		ENDSELECT
		PRINTFORMW …？
		PRINTFORMW パールの末端に、入れられた覚えのない黄金の玉がついている
		CALL COLORMESSAGE(@"お年玉ボーナス！￥{OTOSIDAMA}手に入れた！",C_YELLOW,2)
		MONEY += OTOSIDAMA
	ENDIF
ENDIF

@PEARL_INSERT(ARG,ARG:1)
TFLAG:パール挿入個数 = ARG:1
TFLAG:パール期限 = TIME + TFLAG:パール挿入個数 * 30 + RAND:30 + RAND:30
TFLAG:パール入れた人 = ARG
SOURCE:MASTER:快Ａ += TFLAG:パール挿入個数 * 10
TFLAG:パール排出チェック = TIME

@PEARL_PATIENCE
PRINTFORML アナルパールが肛門からこぼれそうだ…
CALL ASK_M("堪える（気力50）",BASE:MASTER:気力 >= 50, "全力で堪える（気力200）",BASE:MASTER:気力 >= 100, "力を抜く",1)
SELECTCASE RESULT
	CASE 0
		DOWNBASE:MASTER:気力 += 50
		IF !RAND:2
			PRINTFORMW %CALLNAME:MASTER%は排泄感を堪えた
		ELSE
			PRINTFORMW %CALLNAME:MASTER%は排泄感を堪えきれなかった
			CALL PEARL_EJECT("自然排出")
		ENDIF
	CASE 1
		PRINTFORMW %CALLNAME:MASTER%は必死で排泄感を堪えた
		DOWNBASE:MASTER:気力 += 200
	CASE 2
		CALL PEARL_EJECT("自然排出")
ENDSELECT