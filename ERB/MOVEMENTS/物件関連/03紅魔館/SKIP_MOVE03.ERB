@SKIP_MOVE_3(ARG:0,ARG:1)
#DIM 現在の位置

;現在位置取得
現在の位置 = CFLAG:MASTER:現在位置
SIF ARG:1
	現在の位置 = ARG:1

;暫定目的地に直接移動できる場合
IF CAN_MOVE(現在の位置,ARG) & 1
	;そこに移動
	RETURN ARG
ENDIF
;袋小路から行ける場所は固定なので、そこを目指す
;11パチュリー私室、12小悪魔私室からは10図書館のみ
IF (現在の位置 == 311) || (現在の位置 == 312) 
	RETURN 310
ENDIF

;16一階トイレからは9広間のみ
IF (現在の位置 == 316)
	RETURN 309
ENDIF

;20咲夜私室、21空き部屋、22二階トイレ、23メイド妖精詰め所、24大バルコニーからは19二階廊下のみ
IF (現在の位置 == 320) || (現在の位置 == 321) || (現在の位置 == 322) || (現在の位置 == 323) || (現在の位置 == 324)
	RETURN 319
ENDIF

;小バルコニーからは26レミリア私室のみ
IF (現在の位置 == 327)
	RETURN 326
ENDIF

;29倉庫、30使用人部屋、31地下室からは28地下廊下のみ
IF (現在の位置 == 329) || (現在の位置 == 330) || (現在の位置 == 331)
	RETURN 328
ENDIF

;37廃洋館・キッチンと38廃洋館・風呂からは35廃洋館・広間のみ
IF (現在の位置 == 337) || (現在の位置 == 338)
	RETURN 335
ENDIF

;40～42三姉妹各私室からは39二階廊下のみ
IF (現在の位置 == 340) || (現在の位置 == 341) || (現在の位置 == 342)
	RETURN 339
ENDIF

;44レティのかまくら、45チルノのかまくら、46大妖精宅からは43湖畔のみ
IF (現在の位置 == 344) || (現在の位置 == 345) || (現在の位置 == 346) 
	RETURN 343
ENDIF

;48霧の湖・湖底からは47霧の湖のみ
IF (現在の位置 == 348)
	RETURN 347
ENDIF
;49霧の向こうからは43湖畔のみ
IF (現在の位置 == 349)
	RETURN 343
ENDIF

;直接移動できない場合、1つ近い位置を暫定目的地に設定し直してループ
;地点追加時要フォロー（全ケース修正すること）
SELECTCASE ARG % 100

;正門
CASE 1
	;正門に直接行けない場合、（34～42、44～48）外からならば43湖畔を目指す
	IF ((現在の位置 >= 334) && (現在の位置 <= 342)) ||  ((現在の位置 >= 344) && (現在の位置 <= 348))
		RETURN 343
	;それ以外の(直接行けない)場所からは、2庭を目指す
	ELSE
		RETURN 302
	ENDIF
;庭
CASE 2
	;庭を目指す場合、10図書館、11パチュリー私室、12小悪魔私室からは7東テラスを目指す
	IF (現在の位置 == 310) || (現在の位置 == 311) || (現在の位置 == 312)
		RETURN 307
	;15応接間からは8西テラスを目指す
	ELSEIF (現在の位置 == 315) 
		RETURN 308
	;外からならば正門を目指す
	ELSEIF ((現在の位置 >= 334) && (現在の位置 <= 347))  
		RETURN 301
	;それ以外の(直接行けない)場所からは、9広間を目指す
	ELSE
		RETURN 309
	ENDIF
;守衛小屋
CASE 3
	;守衛小屋に直接行けない場合、2庭を目指す
	RETURN 302
;空き小屋
CASE 4
	;空き小屋に直接行けない場合、2庭を目指す
	RETURN 302
;納屋
CASE 5
	;納屋に直接行けない場合、6裏庭を目指す
	RETURN 306
;裏庭
CASE 6
	;裏庭に直接行けない場合、（9～33）館内からならば13厨房を目指す
	IF  ((現在の位置 >= 309) && (現在の位置 <= 333))
		RETURN 313
	;それ以外の(直接行けない)場所からは、2庭を目指す
	ELSE
		RETURN 302
	ENDIF
;東テラス
CASE 7
	;東テラスに直接行けない場合、（11～33）館内からならば10図書館を目指す
	IF (現在の位置 >= 311) && (現在の位置 <= 333)
		RETURN 310
	;それ以外は2庭を目指す
	ELSE
		RETURN 302
	ENDIF
;西テラス
CASE 8
	;西テラスに直接行けない場合、（10～14、16～33）館内からならば15応接間を目指す
	IF ((現在の位置 >= 310) &&(現在の位置 <= 314)) || ((現在の位置 >= 316) && (現在の位置 <= 333))
		RETURN 315
	;それ以外は2庭を目指す
	ELSE
		RETURN 302
	ENDIF
;広間
CASE 9
	;広間に直接いけない場合、5納屋、6裏庭からならば13厨房を目指す
	IF (現在の位置 == 305) || (現在の位置 == 306)
		RETURN 313
	;11パチュリー私室、12小悪魔私室からなら10図書館を目指す
	ELSEIF (現在の位置 == 311) || (現在の位置 == 312)
		RETURN 310
	;（19～27）上層階からなら17大階段を目指す
	ELSEIF ((現在の位置 >= 319) && (現在の位置 <= 327))
		RETURN 317
	;（28～33）からなら18地下階段を目指す
	ELSEIF ((現在の位置 >= 328) && (現在の位置 <= 333))
		RETURN 318
	;それ以外は2庭を目指す
	ELSE
		RETURN 302
	ENDIF
;図書館
CASE 10
	;図書館に直接行けない場合、5納屋、6裏庭及び（13～33）館内からならば9広間を目指す
	IF (現在の位置 == 305) || (現在の位置 == 306) || ((現在の位置 >= 313) && (現在の位置 <= 333))
		RETURN 309
	;それ以外は7東テラスを目指す
	ELSE
		RETURN 307
	ENDIF
;パチュリー私室
CASE 11
	;パチュリー私室に直接行けない場合、10図書館を目指す
	RETURN  310
;小悪魔私室
CASE 12
	;小悪魔私室に直接行けない場合、10図書館を目指す
	RETURN 310
;厨房
CASE 13
	;厨房に直接行けない場合、5納屋からならば6裏庭を目指す
	IF (現在の位置 == 305)
		RETURN 306
	;それ以外は9広間を目指す
	ELSE
		RETURN 309
	ENDIF
;食堂
CASE 14
	;食堂に直接行けない場合、5納屋、6裏庭からならば13厨房を目指す
	IF (現在の位置 == 305) || (現在の位置 == 306)
		RETURN 313
	;それ以外は9広間を目指す
	ELSE
		RETURN 309
	ENDIF
;応接間
CASE 15
	;応接間に直接行けない場合、（10～33）館内からならば9広間を目指す
	IF ((現在の位置 >= 310) && (現在の位置 <= 333))
		RETURN 309
	;それ以外は8西テラスを目指す
	ELSE
		RETURN 308
	ENDIF
;一階トイレ
CASE 16
	;一階トイレに直接行けない場合、9広間を目指す
	RETURN 309
;大階段
CASE 17
	;大階段に直接行けない場合、（20～27）上層階からならば19二階廊下を目指す
	IF ((現在の位置 >= 320) && (現在の位置 <= 327))
		RETURN 319
	;それ以外は9広間を目指す
	ELSE
		RETURN 309
	ENDIF
;地下階段
CASE 18
	;地下階段に直接行けない場合、（29～33）地下からならば28地下廊下を目指す
	IF ((現在の位置 >= 329) && (現在の位置 <= 333))
		RETURN 328
	;それ以外は9広間を目指す
	ELSE
		RETURN 309
	ENDIF
;二階廊下
CASE 19
	;二階廊下に直接行けない場合、（26、27）三階からならば25三階階段を目指す
	IF (現在の位置 == 326) || (現在の位置 == 327)
		RETURN 325
	;それ以外は17大階段を目指す
	ELSE
		RETURN 317
	ENDIF
;咲夜私室
CASE 20
	;咲夜私室に直接行けない場合、19二階廊下を目指す
	RETURN 319
;空き部屋
CASE 21
	;空き部屋に直接行けない場合、19二階廊下を目指す
	RETURN 319
;二階トイレ
CASE 22
	;二階トイレに直接行けない場合、19二階廊下を目指す
	RETURN 319
;メイド妖精詰め所
CASE 23
	;メイド妖精詰め所に直接行けない場合、19二階廊下を目指す
	RETURN 319
;大バルコニー
CASE 24
	;大バルコニーに直接行けない場合、19二階廊下を目指す
	RETURN 319
;三階階段
CASE 25
	;三階階段に直接行けない場合、27小バルコニーからは26レミリア私室を目指す
	IF (現在の位置 == 327)
		RETURN 326
	;それ以外は19二階廊下を目指す
	ELSE
		RETURN 319
	ENDIF
;レミリア私室
CASE 26
	;レミリア私室に直接行けない場合、25三階階段を目指す
	RETURN 325
;小バルコニー
CASE 27
	;小バルコニーに直接行けない場合、26レミリア私室を目指す
	RETURN 326
;地下廊下
CASE 28
	;地下廊下に直接行けない場合、33大浴場からは32脱衣室を目指す
	IF (現在の位置 == 333)
		RETURN 332
	;それ以外は18地下階段を目指す
	ELSE
		RETURN 318
	ENDIF
;倉庫
CASE 29
	;倉庫に直接いけない場合、28地下廊下を目指す
	RETURN 328
;使用人部屋
CASE 30
	;使用人部屋に直接いけない場合、28地下廊下を目指す
	RETURN 328
;地下室
CASE 31
	;地下室に直接いけない場合、28地下廊下を目指す
	RETURN 328
;脱衣所
CASE 32
	;脱衣所に直接いけない場合、28地下廊下を目指す
	RETURN 328
;大浴場
CASE 33
	;大浴場に直接いけない場合、32脱衣所を目指す
	RETURN 332
;廃洋館・入口
CASE 34
	;廃洋館・入口に直接いけない場合、（36～42）館内ならば35広間を目指す
	IF ((現在の位置 >= 336) && (現在の位置 <= 342))
		RETURN 335
	;それ以外は343湖畔を目指す
	ELSE
		RETURN 343
	ENDIF
;廃洋館・広間
CASE 35
	;廃洋館・広間に直接いけない場合、（39～42）二階ならば36階段を目指す
	IF ((現在の位置 >= 339) && (現在の位置 <= 342))
		RETURN 336
	;それ以外は334廃洋館・入口を目指す
	ELSE
		RETURN 334
	ENDIF
;廃洋館・階段
CASE 36
	;廃洋館・階段に直接いけない場合、（40～42）二階ならば39二階廊下を目指す
	IF ((現在の位置 >= 340) && (現在の位置 <= 342))
		RETURN 339
	;それ以外は335廃洋館広間を目指す
	ELSE
		RETURN 335
	ENDIF
;廃洋館・キッチン
CASE 37
	;廃洋館・キッチンに直接いけない場合、35広間を目指す
	RETURN 335
;廃洋館・風呂
CASE 38
	;廃洋館・風呂に直接いけない場合、35広間を目指す
	RETURN 335
;廃洋館・二階廊下
CASE 39
	;廃洋館・二階廊下に直接いけない場合、36階段を目指す
	RETURN 336
;廃洋館・ルナサ私室
CASE 40
	;廃洋館・ルナサ私室に直接いけない場合、39二階廊下を目指す
	RETURN 339
;廃洋館・メルラン私室
CASE 41
	;廃洋館・メルラン私室に直接いけない場合、39二階廊下を目指す
	RETURN 339
;廃洋館・リリカ私室
CASE 42
	;廃洋館・リリカ私室に直接いけない場合、39二階廊下を目指す
	RETURN 339
;湖畔
CASE 43
	;湖畔に直接行けない場合、（2～33）紅魔館からならば1正門を目指す
	IF ((現在の位置 >= 302) && (現在の位置 <= 333))
		RETURN 301
	;48霧の湖・湖底からなら47霧の湖を目指す
	ELSEIF (現在の位置 == 348)
		RETURN 347
	;それ以外は34廃洋館・入口を目指す
	ELSE
		RETURN 334
	ENDIF
;レティのかまくら
CASE 44
	;レティのかまくらを目指す場合、43湖畔を目指す
	RETURN 343
;チルノのかまくら
CASE 45
	;チルノのカマクラを目指す場合、43湖畔を目指す
	RETURN 343
;大妖精宅
CASE 46
	;大妖精宅を目指す場合、43湖畔を目指す
	RETURN 343
;霧の湖
CASE 47
	;霧の湖を目指す場合、43湖畔を目指す
	RETURN 343
;霧の湖・湖底
CASE 48
	;霧の湖・湖底を目指す場合、47霧の湖を目指す
	RETURN 347
;霧の向こう
CASE 49
	;霧の向こうを目指す場合、43正門を目指す
	RETURN 343
ENDSELECT
