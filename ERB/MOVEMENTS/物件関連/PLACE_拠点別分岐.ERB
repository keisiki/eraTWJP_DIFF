@GET_EXISTMAP(ARG)
#FUNCTION
SIF GROUPMATCH(ARG, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10)
	RETURNF 1

;------------------------------------------
;対象マップの呼び名文字列を返す
;COMF410_掃除.ERB、呼び出し元
;要参照MAP_COMM_0.ERB
;ARG,MAPID
;ARG:1,キャラID
;------------------------------------------
@GET_MAPNAME(ARG, ARG:1 = 0)
#FUNCTIONS
#DIMS PNAME
SELECTCASE ARG
	CASE 0
		PNAME = 博麗神社
	CASE 1
		PNAME = 命蓮寺
	CASE 2
		PNAME = 人間の里
	CASE 3
		PNAME = 霧の湖～紅魔館
	CASE 4
		PNAME = 迷いの竹林
	CASE 5
		PNAME = 魔法の森
	CASE 6
		PNAME = 三途の川～冥界
	CASE 7
		PNAME = 妖怪の山 (山麓)
	CASE 8
		PNAME = 妖怪の山 (山頂)
	CASE 9
		PNAME = 地底
	CASE 10
		PNAME = 夢の世界～月
	CASEELSE
		PNAME = 謎の領域
ENDSELECT
RETURNF PNAME

;FileName_COMMON.ERB ------------------------------- Rev1.00
;風呂を追い出される先
;CALL		USER
;ARG		VOID
;RETURN		脱出先の場所
;COMMENT	場所を変更した場合、RETURNFを変更の事
;-----------------------------------------------------------
@KICKOUT(ARG)
#FUNCTION
IF MAIN_MAP == GET_MAPID(CFLAG:MASTER:現在位置)
	SELECTCASE MAIN_MAP
		CASE 0
			RETURNF KICKOUT_0()
		CASE 1
			RETURNF KICKOUT_1()
		CASE 2
			RETURNF KICKOUT_2()
		CASE 3
			RETURNF KICKOUT_3()
		CASE 4
			RETURNF KICKOUT_4()
		CASE 5
			RETURNF KICKOUT_5()
		CASE 6
			RETURNF KICKOUT_6()
		CASE 7
			RETURNF KICKOUT_7()
		CASE 8
			RETURNF KICKOUT_8()
		CASE 9
			RETURNF KICKOUT_9()
		CASE 10
			RETURNF KICKOUT_10()
	ENDSELECT
ENDIF
RETURNF CFLAG:MASTER:前ターン位置

;------------------------------------------
;マップごとに移動できない状況がある場合に呼び出す（温泉に人がいる、鍵を締めている　など）
;要参照COMF400_移動.ERB
;ARG,場所ID
;ARG:1,キャラID,省略すると0=MASTER,現状キャラ移動以外では使いません
;------------------------------------------
@MAP_CAN_MOVE(ARG, ARG:1)
#FUNCTION
#DIM 家主
#DIM 在宅
IF ROOMDATA:(ARG % 100) & 場所_ワンルーム
	家主 = PRIVATEROOM:(ARG % 100)
	在宅 = 0
	;あなた
	IF ARG:1 == MASTER
		;自宅なら可能
		IF ARG == デフォルト初期位置
			RETURNF 1
		;同行か恋慕なら入れる（家主睡眠中も可
		ELSEIF CFLAG:家主:同行 || TALENT:家主:恋慕
			在宅 = 1
		;家主がいて起きてる
		ELSEIF CFLAG:家主:現在位置 == ARG
			IF !CFLAG:家主:睡眠 && !CFLAG:家主:添い寝中 && !TCVAR:家主:泥酔 && !CFLAG:家主:衰弱
				在宅 = 1
			ENDIF
		;家主以外の誰かがいる,この人物は寝てたりしても良い
		ELSEIF IN_ROOM_NUMBER(ARG)
			在宅 = 1
		ENDIF
	;家主は入れる
	ELSEIF ARG:1 == 家主
		在宅 = 1
	;そうでないキャラは相性が100を超えていないとダメ
	ELSEIF RELATION:家主:(ARG:1) > 100
		在宅 = 1
	ENDIF
	IF !在宅
		TFLAG:移動不能メッセージ = 999
		RETURNF 0
	ENDIF
ENDIF

IF !MAIN_MAP
	SIF STR:ARG == ""
	RETURNF 0
ELSEIF STR:(8000 + ARG) == ""
	RETURNF 0
ENDIF
SELECTCASE MAIN_MAP
	CASE 0
		RETURNF MAP_CAN_MOVE_0(ARG, ARG:1)
	CASE 1
		RETURNF MAP_CAN_MOVE_1(ARG, ARG:1)
	CASE 2
		RETURNF MAP_CAN_MOVE_2(ARG, ARG:1)
	CASE 3
		RETURNF MAP_CAN_MOVE_3(ARG, ARG:1)
	CASE 4
		RETURNF MAP_CAN_MOVE_4(ARG, ARG:1)
	CASE 5
		RETURNF MAP_CAN_MOVE_5(ARG, ARG:1)
	CASE 6
		RETURNF MAP_CAN_MOVE_6(ARG, ARG:1)
	CASE 7
		RETURNF MAP_CAN_MOVE_7(ARG, ARG:1)
	CASE 8
		RETURNF MAP_CAN_MOVE_8(ARG, ARG:1)
	CASE 9
		RETURNF MAP_CAN_MOVE_9(ARG, ARG:1)
	CASE 10
		RETURNF MAP_CAN_MOVE_10(ARG, ARG:1)
ENDSELECT
RETURNF 1

;------------------------------------------
;地点関連性応答処理
;要参照MOVEMENT_CAN_MOVE_0.ERB
;ARG,現在地点
;ARG:1,比較先地点
;------------------------------------------
@CAN_MOVE(ARG, ARG:1)
#FUNCTION

IF MAIN_MAP == GET_MAPID(ARG)
SELECTCASE MAIN_MAP
	CASE 0
		RETURNF CAN_MOVE_0(ARG, ARG:1)
	CASE 1
		RETURNF CAN_MOVE_1(ARG, ARG:1)
	CASE 2
		RETURNF CAN_MOVE_2(ARG, ARG:1)
	CASE 3
		RETURNF CAN_MOVE_3(ARG, ARG:1)
	CASE 4
		RETURNF CAN_MOVE_4(ARG, ARG:1)
	CASE 5
		RETURNF CAN_MOVE_5(ARG, ARG:1)
	CASE 6
		RETURNF CAN_MOVE_6(ARG, ARG:1)
	CASE 7
		RETURNF CAN_MOVE_7(ARG, ARG:1)
	CASE 8
		RETURNF CAN_MOVE_8(ARG, ARG:1)
	CASE 9
		RETURNF CAN_MOVE_9(ARG, ARG:1)
	CASE 10
		RETURNF CAN_MOVE_10(ARG, ARG:1)
ENDSELECT
ENDIF
RETURNF 0
;------------------------------------------
;場所IDの名前文字列を返す
;要参照ステータス表示関連/INFO.ERB、COMF400_移動.ERB、呼び出し元
;要参照MAP_COMM_0.ERB
;ARG,場所ID
;------------------------------------------
@NAME_FROM_PLACE(ARG)
#FUNCTIONS
#DIM MAPID
#DIMS PNAME
PNAME = 
MAPID = GET_MAPID(ARG)
IF TFLAG:妄想中 == 1
	PNAME =素敵空間
ELSEIF ARG == OMANEKIBEYA()
;	お招き部屋の名前処理
	RETURNF OMANEKI_PLACE()
ELSEIF ARG == SUMIKOMI_ROOM && FLAG:住み込みキャラ && MAPID == MAIN_MAP
	PNAME = %CALLNAME:(FLAG:住み込みキャラ)%の%SUMIKOMI_PN%
ELSEIF MAPID == MAIN_MAP
;
;	物件マップ内の名前処理
;
	SELECTCASE MAPID
		CASE 0
			PNAME = %MAP_PLACENAME_0(ARG)%
		CASE 1
			PNAME = %MAP_PLACENAME_1(ARG)%
		CASE 2
			PNAME = %MAP_PLACENAME_2(ARG)%
		CASE 3
			PNAME = %MAP_PLACENAME_3(ARG)%
		CASE 4
			PNAME = %MAP_PLACENAME_4(ARG)%
		CASE 5
			PNAME = %MAP_PLACENAME_5(ARG)%
		CASE 6
			PNAME = %MAP_PLACENAME_6(ARG)%
		CASE 7
			PNAME = %MAP_PLACENAME_7(ARG)%
		CASE 8
			PNAME = %MAP_PLACENAME_8(ARG)%
		CASE 9
			PNAME = %MAP_PLACENAME_9(ARG)%
		CASE 10
			PNAME = %MAP_PLACENAME_10(ARG)%
	ENDSELECT
ELSEIF ARG < 2000
	;おでかけマップの方
	PNAME = %STR:(6000 + (ARG / 10))%
ELSE
;
;	道中他、その他範囲
;
	PNAME = %STR:(ARG)%
ENDIF
RETURNF PNAME

@MAP_住人(ARG,ARG:1)
#FUNCTION
;CSVの初期位置を取得
LOCAL = CSVCFLAG(ARG:1,311)
SIF LOCAL == 99 || !LOCAL
	RETURNF 0
SIF LOCAL / 100 == ARG
	RETURNF 1

;-----------------------------------------
;非自宅時に差し替える場所IDを返す関数
;ARG,対象ID
;RETURNF,差し替え済み対象ID
;-----------------------------------------
@GET_MAP_REPLACEMENT(ARG)
#FUNCTION
#DIM 対象マップ
#DIM OUTID
OUTID = 0
対象マップ =  GET_MAPID(ARG)
SIF MAIN_MAP == 対象マップ
	RETURNF ARG

SELECTCASE 対象マップ
	CASE 0
		OUTID = MAP_SEARCH_REPLACEMENT_0(ARG)
	CASE 1
		OUTID = MAP_SEARCH_REPLACEMENT_1(ARG)
	CASE 2
		OUTID = MAP_SEARCH_REPLACEMENT_2(ARG)
	CASE 3
		OUTID = MAP_SEARCH_REPLACEMENT_3(ARG)
	CASE 4
		OUTID = MAP_SEARCH_REPLACEMENT_4(ARG)
	CASE 5
		OUTID = MAP_SEARCH_REPLACEMENT_5(ARG)
	CASE 6
		OUTID = MAP_SEARCH_REPLACEMENT_6(ARG)
	CASE 7
		OUTID = MAP_SEARCH_REPLACEMENT_7(ARG)
	CASE 8
		OUTID = MAP_SEARCH_REPLACEMENT_8(ARG)
	CASE 9
		OUTID = MAP_SEARCH_REPLACEMENT_9(ARG)
	CASE 10
		OUTID = MAP_SEARCH_REPLACEMENT_10(ARG)
	CASEELSE
		OUTID = ARG
ENDSELECT

SIF OUTID > 0
	RETURNF OUTID

;そのキャラがあなたから見える位置にいるか
@CAN_SEE(ARG)
#FUNCTION
SIF CFLAG:MASTER:現在位置 == CFLAG:ARG:現在位置
	RETURNF 1
SIF CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:ARG:現在位置) == 2
	RETURNF 1
RETURNF 0

;-----------------------------------------
;私室に最も近い共用風呂を判定する関数
;ヒノキ風呂の効果を付与する際の判定に利用
;ARG =1のときは設置場所を表記する時に利用する
;基本は=0
;-----------------------------------------
@NEAR_BATH(ARG = 0)
#FUNCTION

;拠点でなければ判定しない
SIF !IN_HOME(CFLAG:MASTER:現在位置) && ARG == 0
	RETURNF 0
SELECTCASE CFLAG:MASTER:初期位置
	CASE 35, 32, 33, 34;博麗神社・三妖精の家地下室　三妖精の私室→30三妖精の家・風呂
		RETURNF 30
	CASE 51, 43, 44;夢幻遺跡・倉庫　夢美ちゆり私室→39夢幻遺跡・浴室
		RETURNF 39
	CASE 53, 15, 16, 17, 18, 19, 52, 54, 55;博麗神社・納戸　ほか、博麗神社内私室→13風呂
		RETURNF 13
	CASE 108, 109, 113 TO 120;命蓮寺・離れ　ほか命蓮寺内私室→112浴室
		RETURNF 112
	CASE 134, 125, 127, 128;聖徳道場・蔵　ほか道場内私室→133湯殿
		RETURNF 133
	CASE 230, 226, 221, 224, 225, 231 TO 235;人里・あなたの部屋　ほか私室→228貸切浴場
		RETURNF 228
	CASE 304, 303, 311, 312, 320, 321, 326, 329, 331;霧の湖～紅魔館・空き小屋　ほか私室→333大浴場
		RETURNF 333
	CASE 340 TO 342, 344 TO 346, 348;廃洋館と霧の湖周りの私室→338廃洋館・風呂
		RETURNF 338
	CASE 410 TO 414, 423, 424, 427, 428, 430;永遠亭・空き部屋or二階空き部屋　ほか、私室→420風呂
		RETURNF 
	CASE 442, 432, 437, 439, 440, 443, 445;迷いの竹林・空き小屋　ほか、私室→441温泉
		RETURNF 441
	CASE 460, 451, 452, 457, 459, 463;夢幻館 空室　ほか、私室→454夢幻館 風呂
		RETURNF 454
	CASE 515, 512, 541 TO 544;魔法の森・魔理沙宅・倉庫　ほか、森の私室→514魔理沙宅・風呂
		RETURNF 514
	CASE 531, 521, 522, 523;魔法の森・人形の館・空き部屋　ほか私室→526人形の館・風呂
		RETURNF 526
	CASE 536, 535;魔法の森・エレン宅・倉庫　エレン私室→537エレン宅・風呂
		RETURNF 537
	CASE 618, 608, 609, 615, 616;是非直曲庁・空き部屋　ほか、私室→617風呂
		RETURNF 617
	CASE 625, 623, 624;冥界・あなたの部屋　妖夢、幽々子私室→627風呂
		RETURNF 627
	CASE 634, 633, 635, 638;八雲邸空部屋　紫藍橙私室→636風呂
		RETURNF 636
	CASE 644, 645;袿姫、磨弓私室→643霊長園の風呂
		RETURNF 643
	CASE 648;八千慧宅の寝室→646八千慧宅の風呂
		RETURNF 646
	CASE 651;早鬼宅の寝室→652早鬼宅の風呂
		RETURNF 652
	CASE 719, 734, 704, 706, 717, 733, 736;妖怪の山・山麓・秋姉妹の家・座敷or小屋　ほか私室→735水浴び場
		RETURNF 735
	CASE 728, 727;仙人の屋敷・空き部屋　華扇私室→721仙人の屋敷・風呂
		RETURNF 721
	CASE 810, 823, 807, 808, 809, 817, 818, 820;妖怪の山・山頂・山小屋or空室→825風呂
		RETURNF 825
	CASE 842, 839, 840, 841;比那名居邸物置　ほか、私室→837比那名居邸風呂
		RETURNF 837
	CASE 916, 943, 911, 912, 918, 919;地底・物置orあばら家→921風呂
		RETURNF 921
	CASE 1006 TO 1009, 1032, 1033, 1041, 1042;月の都と綿月亭→1030綿月亭 風呂
		RETURNF 1030
	CASE 1051, 1052;ドレミー宅→1042ドレミー宅 風呂
		RETURNF 1054
	CASE 1063, 1064, 1071, 1072;純狐邸→1049純狐邸 風呂
		RETURNF 1067
	CASEELSE
		RETURNF 0
ENDSELECT
