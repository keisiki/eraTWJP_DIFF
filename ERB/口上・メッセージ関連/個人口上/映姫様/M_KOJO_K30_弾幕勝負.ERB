;==================================================
;弾幕勝負
;==================================================
;
@M_KOJO_MESSAGE_COM_K30_DANMAKU(ARGS, 相手残機)
#DIM 相手残機
;全体の流れ
;①【戦闘前】→②ダイスロールとプレイヤー選択肢、ハンデをつけた場合は【ハンデ口上】→③対応スキルが発動した場合【スキル口上】→④被弾判定、キャラが被弾したなら【被弾口上】→
;どちらかの残機が0になっていなければ②に戻る→⑤【戦闘後口上】

;--------------------------------------------------
;記入チェック（=0, 非表示、1, 表示）
LOCAL = 1
;-------------
IF LOCAL
SIF FLAG:口上色
	TRYCALLFORM M_KOJO_COLOR_K{NO:TARGET}
	;-------------------------------------------------
	;小分岐
	;-------------------------------------------------
	;戦闘前
	HANDICAP_FIXED = 0
	HANDICAP_RAND = 0
	;花映塚でくっそ強かった覚えがあるけどハンデ表記されるならいじらない
	
	;ハンデをつけることができ、数値が大きいほどあなたが不利になる　数値が負ならあなたが有利に
	;キャラの能力に関わらずクッソ強くしたり弱くしたりできる
	;記入チェック（=0, 非表示、1, 表示）
	LOCAL:1 = 1
	;-------------------------------------------------
	IF LOCAL:1 && ARGS == "戦闘前"
		IF CFLAG:318 == 1
			PRINTFORMW 「この場で裁かれなさい！！」
		ELSE
			SELECTCASE RAND:3
				CASE 0
					PRINTFORMW 「貴方の罪の重さ、計るとしましょう」
				CASE 1
					PRINTFORMW 「私の教え、きちんと守ってるかしら？」
				CASE 2
					PRINTFORMW 「私、弾幕での『対戦』には自信があるのよ」
			ENDSELECT
		ENDIF
		RETURN 0
	ENDIF
	;-------------------------------------------------
	;ハンデ
	;記入チェック（=0, 非表示、1, 表示）
	LOCAL:1 = 0
	;-------------------------------------------------
	IF LOCAL:1 && ARGS == "ハンデ"
		;ハンデつけなかったら表示されないので無記入でよい
		PRINTFORML 
		RETURN 0
	ENDIF
	;-------------------------------------------------
	;戦闘中TARGET被弾時口上
	;記入チェック（=0, 非表示、1, 表示）
	LOCAL:1 = 1
	;-------------------------------------------------
	IF LOCAL:1 && ARGS == "被弾" 
		;別に一律で「やられたー」だけでもいいよ
		SELECTCASE 相手残機
			;残り残機3が表示されるのは【洽覧深識】持ちのみ
			CASE 3
				PRINTFORML 
			CASE 2
				IF CFLAG:318 == 1
					PRINTFORMW 「…次」
				ELSE
					PRINTFORML 「私の教えを守っていればこのくらい当然です」
					PRINTFORMW 「次はもう少し試しますよ」
				ENDIF
				PRINTFORMW 「審判『十王裁判』！」
			CASE 1
				IF CFLAG:318 == 1
					PRINTFORMW 「…これで終わりよ」
				ELSE
					PRINTFORML 「なかなかやりますね」
					PRINTFORMW 「さあ、これで白黒はっきりつけましょう」
				ENDIF
				PRINTFORMW 「審判『ラストジャッジメント』！！」
			CASE 0
				IF CFLAG:318 == 1
					PRINTFORMW 「…くっ」
				ELSE
					PRINTFORMW 「お見事です」
				ENDIF
		ENDSELECT
	ENDIF
	;-------------------------------------------------
	;戦闘中
	;TARGETの【残忍酷薄】発動時
	;ARGはTARGETの残機
	;記入チェック（=0, 非表示、1, 表示）
	LOCAL:1 = 0
	;-------------------------------------------------
	IF LOCAL:1 && ARGS == "残忍酷薄"
		
	ENDIF
	;-------------------------------------------------
	;戦闘中
	;TARGETの【乾坤一擲】発動時
	;ARGはTARGETの残機
	;記入チェック（=0, 非表示、1, 表示）
	LOCAL:1 = 1
	;-------------------------------------------------
	IF LOCAL:1 && ARGS == "乾坤一擲"
		IF CFLAG:318 == 1
			PRINTFORMW 「……小賢しい」
		ELSE
			PRINTFORMW 「ここが勝負どころですね」
		ENDIF
	ENDIF
	;-------------------------------------------------
	;戦闘中
	;TARGETの【怪力乱神】発動時
	;ARGはTARGETの残機
	;記入チェック（=0, 非表示、1, 表示）
	LOCAL:1 = 0
	;-------------------------------------------------
	IF LOCAL:1 && ARGS == "怪力乱神"
		
	ENDIF
	
	;-------------------------------------------------
	;戦闘後
	;記入チェック（=0, 非表示、1, 表示）
	LOCAL:1 = 1
	;-------------------------------------------------
	IF LOCAL:1 && ARGS == "戦闘後" 
		PRINTFORML 
		;残り残機4が表示されうるのは【洽覧深識】持ちのみ
		;残機が1以上ならあなたの負け、0の場合はあなたの勝利
		SELECTCASE 相手残機
			CASE 4
				PRINTFORML 
			CASE 3
				IF CFLAG:318 == 1
					PRINTFORMW 「…判決は地獄行きよ。救われることもなさそうね」
				ELSE
					PRINTFORMW 「何をやってるんです。しっかりしなさい！」
				ENDIF
			CASE 2
				IF CFLAG:318 == 1
					PRINTFORMW 「…判決は畜生界行きね。畜生の餌にでもなってきなさい」
				ELSE
					PRINTFORMW 「うーん、まず私の教えをちゃんと覚えていますか？」
				ENDIF
			CASE 1
				IF CFLAG:318 == 1
					PRINTFORMW 「…判決では人界に留まれるわ。大いに悔い改めることね」
				ELSE
					PRINTFORMW 「惜しいところですが、日々の積み重ねが足りなかったとも言えます」
				ENDIF
			CASE 0
				;日記フラグ＠映姫様が負けた
				IF DIARY:30:4 == 0
					CALL K30_WRITE_DIARY(4)
					;過去に映姫様が勝利してたら分岐
					SIF STRCOUNT(CSTR:30:0, "勝利")
						SETBIT CFLAG:1910, 1
				ENDIF
				IF CFLAG:318 == 1
					PRINTFORMW 「………判決は保留します」
				ELSE
					PRINTFORML 「よくやりました。でもここで終わりではありませんよ」
					PRINTFORMW 「善行も修練も積み重ねてこそです。これからも精進を続けてください」
				ENDIF
		ENDSELECT
		;日記フラグ＠あなたが負けた
		IF 相手残機 > 0
			CALLF FIRSTTIME("勝利")
			IF DIARY:30:3 == 0 && !CFLAG:30:弾幕勝負勝利
				CALL K30_WRITE_DIARY(3)
				SIF 相手残機 == 1
					SETBIT CFLAG:1910, 0
			ENDIF
		ENDIF
	ENDIF
RESETCOLOR
ENDIF
RETURN 1

