@HININSHITE(ARG)

IF ESTRUS_CYCLE(ARG) == 150
	LOCALS = 危険日な
ELSEIF ESTRUS_CYCLE(ARG) != 15
	LOCALS = 安全日じゃない
ENDIF

PRINTFORML %CALLNAME:ARG%は今日は%LOCALS%のでちゃんと避妊してほしいと言ってきた…
CALL KOJO_MESSAGE_SEND("EVENT",18,TARGET,1,0)
{
	CALL ASK_M("あきらめる",1,@"コンドームをつける（残り{ITEM:45}枚）",ITEM:45,@"ピルを渡す（残り{ITEM:49}錠）",ITEM:49,
	"ナマでやらせて下さいお願いします", !TCVAR:懇願, "いいや妊娠だけは絶対して貰う", (TEQUIP:TARGET:縄 || TEQUIP:TARGET:拘束 || CFLAG:TARGET:負け犬))
}
IF RESULT == 1
	ITEM:45 -= 1
	PRINTL コンドームをつけた
	TEQUIP:MASTER:コンドーム = 1
ELSEIF RESULT == 2
	ITEM:49 -= 1
	TCVAR:ARG:ピル = 1
	PRINTFORML %CALLNAME:ARG%にピルを飲んでもらった 
ELSEIF RESULT == 3
	TCVAR:ARG:懇願 = 1
	CALL OGAMITAOSHI(ARG)
	SIF RESULT == -1
		RETURN -1
ELSEIF RESULT == 4
	TCVAR:ARG:無理矢理 = 1
ELSE
	PRINTFORML 残念だがあきらめよう
	RESULT = -1
	RETURN -1
ENDIF

@避妊要求(ARG)
SIF CFLAG:ARG:生解禁  == 2
	RETURN
SIF !妊娠可否(ARG)
	RETURN
SIF !HAS_PENIS(MASTER)
	RETURN
SIF TALENT:ARG:無知
	RETURN
SIF TFLAG:16
	RETURN
SIF TCVAR:ARG:無理矢理
	RETURN
SIF !SHIRAHU(ARG)
	RETURN
SIF TCVAR:ARG:挿入拒絶
	RETURN -1
;安全日
SIF ESTRUS_CYCLE(ARG) == 15
	RETURN
IF !CFLAG:ARG:生解禁
	CALL HININSHITE(ARG)
ELSEIF ESTRUS_CYCLE(ARG) == 150
	CALL HININSHITE(ARG)
ENDIF
SIF RESULT == -1
	RETURN -1


@妊娠可否(ARG)
#FUNCTION
SIF TEQUIP:PLAYER:コンドーム || TCVAR:ARG:ピル
	RETURNF 0
SIF TALENT:ARG:幼稚 && !TALENT:ARG:初潮
	RETURNF 0
SIF ((CHECK_CHARA(ARG, "幽霊") || CHECK_CHARA(ARG, "人形") || CHECK_CHARA(ARG, "蓬莱人")) && !CFLAG:ARG:子供人数) || TALENT:ARG:妊娠
	RETURNF 0
RETURNF 1

@AUTO_CONTRACEPTION(ARG)
IF CFLAG:ARG:妊娠経過日数 <= 30 && TALENT:ARG:妊娠
	PRINTFORMW 安定期まではやめておこう
	RETURN -1
ENDIF
IF CFLAG:ARG:妊娠経過日数 > 70 && TALENT:ARG:妊娠
	PRINTFORMW 赤ちゃんが心配なのでやめておこう
	RETURN -1
ENDIF
SIF !TALENT:ARG:育児中
	RETURN
SIF !HAS_PENIS(MASTER)
	RETURN
SIF TEQUIP:PLAYER:コンドーム || TCVAR:ARG:ピル
	RETURN
SIF CFLAG:ARG:出産経過日 >= CHILD_就学
	RETURN
PRINTFORML 育児中の%CALLNAME:ARG%の負担を増やすべきではないので避妊しよう
CALL ASK_M("コンドームをつける",ITEM:コンドーム,"ピルを飲ませる",ITEM:ピル,"諦める",1)
SELECTCASE RESULT
	CASE 0
		ITEM:コンドーム --
		TEQUIP:PLAYER:コンドーム = 1
		PRINTL コンドームをつけた
		RETURN 1
	CASE 1
		ITEM:ピル --
		TCVAR:ARG:ピル = 1
		PRINTFORML %CALLNAME:ARG%にピルを飲んでもらった 
		RETURN 1
	CASE 2
		PRINTFORML 残念だが諦めることにした
		RETURN -1
ENDSELECT

@ChkBeforeInsert(ARG)
CALL AUTO_SKIN_EQUIP
IF GROUPMATCH(TALENT:ARG:処女, 1, -1)
	CALL LOST_VIRGIN_STOP(ARG)
	SIF RESULT == -1
		RETURN -1
ENDIF
CALL AUTO_CONTRACEPTION(ARG)
SIF RESULT == -1
	RETURN -1
CALL 避妊要求(ARG)
IF RESULT == -1
	RETURN -1
ENDIF