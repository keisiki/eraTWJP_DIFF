;-------------------------------------------------
;日付が第〇タームか取得
;-------------------------------------------------
@GET_TERM(ARG)
#FUNCTION

SIF !ARG
	ARG = DAY:3

SIF ARG == 31
	ARG = 30

RETURNF ((ARG - 1) / 5) + 1

;-------------------------------------------------
;当該時刻の指定分後の季節・日付・時刻を取得
;RESULT:0=季節　RESULT:1=日付　RESULT:2=時刻　
;注意 指定分は1年を超えないこと
;-------------------------------------------------
@CALCULATE_ADD_TIME(季節, 日付, 時刻, 指定分)
#DIM 季節
#DIM 日付
#DIM 時刻
#DIM 指定分
#DIM 取得季節
#DIM 取得日付
#DIM 取得時刻

取得季節 = 0
取得日付 = 0
取得時刻 = 0

取得時刻 = 時刻 + 指定分
IF 取得時刻 >= 1440
	LOCAL:0 = 取得時刻
	取得時刻 %= 1440
	取得日付 += LOCAL:0 / 1440
ENDIF

取得日付 += 日付
IF 取得日付 >= 32
	LOCAL:1 = 取得日付
	取得日付 %= 32
	取得季節 += LOCAL:1 / 32
	取得日付 += LOCAL:1 / 32
ENDIF

取得季節 += 季節
IF 取得季節 >= 5
	取得季節 = 1
ENDIF

RETURN 取得季節, 取得日付, 取得時刻

;-------------------------------------------------
;当該タームの指定ターム後の季節・タームを取得
;RESULT:0=季節　RESULT:1=ターム　
;注意 指定タームは1年を超えないこと
;-------------------------------------------------
@CALCULATE_ADD_TERM(季節, ターム, 指定ターム)
#DIM 季節
#DIM ターム
#DIM 指定ターム
#DIM 取得季節
#DIM 取得ターム

取得ターム = ターム + 指定ターム
IF 取得ターム >= 7
	LOCAL = 取得ターム
	取得ターム %= 7
	取得季節 += LOCAL / 7
	取得ターム += LOCAL / 7
ENDIF

取得季節 += 季節
IF 取得季節 >= 5
	取得季節 = 1
ENDIF

RETURN 取得季節, 取得ターム

;-------------------------------------------------
;短期予報
;-------------------------------------------------
@WEATHER_FORECAST_1TERM
#DIM 位置倍率
#DIM 予想経過時間
#DIM 日本海低気圧発生判定
#DIM 南岸低気圧発生判定

;タームをまたいだ場合に処理を続行
SIF NOW_TERM == GET_TERM()
	RETURN

;現在のターム数を設定
NOW_TERM = GET_TERM()

;梅雨・秋雨入り判定
IF DAY:2 == 1 && NOW_TERM == 6
	IS_RAINY_SEASON1:0 = 1
ELSEIF DAY:2 == 3 && NOW_TERM == 1
	IS_RAINY_SEASON2 = 1
ENDIF

;現在のタームにおける寒気・暖気の強さを設定
POWER_COLD_AIR = RAND:5 + 1
POWER_WARM_AIR = RAND:5 + 1

;寒気・暖気による作物への影響
IF FLAG:地主 > 0
	IF (POWER_WARM_AIR == 3 || POWER_WARM_AIR == 4) && (DAY:2 == 1 || DAY:2 == 3)
		FLAG:畑仕事の成果 += 10
	ELSEIF POWER_COLD_AIR == 5 && DAY:2 == 1
		FLAG:畑仕事の成果 = MAX(0, FLAG:畑仕事の成果 - 10)
		AMOUNT_COLD_CROP_DAMAGE += 10
	ENDIF
ENDIF

;梅雨・秋雨明け判定
IF IS_RAINY_SEASON1:0 == 1 && POWER_WARM_AIR >= 3
	IS_RAINY_SEASON1:1 = 1
ELSEIF IS_RAINY_SEASON1:1 == 1 || (DAY:2 == 3 && NOW_TERM == 1)
	IS_RAINY_SEASON1:0 = 0
	IS_RAINY_SEASON1:1 = 0
ELSEIF DAY:2 == 3 && NOW_TERM == 2
	IS_RAINY_SEASON2 = 0
ENDIF

;梅雨による作物への影響
IF FLAG:地主 > 0
	IF DAY:2 == 2 && (NOW_TERM == 1 || NOW_TERM == 2) && IS_RAINY_SEASON1:0 == 1
		FLAG:畑仕事の成果 += 20
	ELSEIF DAY:2 == 2 && NOW_TERM == 4 && IS_RAINY_SEASON1:0 == 1
		FLAG:畑仕事の成果 = MAX(0, FLAG:畑仕事の成果 - 20)
	ELSEIF DAY:2 == 2 && NOW_TERM == 5 && IS_RAINY_SEASON1:0 == 1
		FLAG:畑仕事の成果 = MAX(0, FLAG:畑仕事の成果 - 40)
		IS_COLD_CROP_DAMAGE ++
	ELSEIF DAY:2 == 2 && NOW_TERM == 6 && IS_RAINY_SEASON1:0 == 1
		FLAG:畑仕事の成果 = MAX(0, FLAG:畑仕事の成果 - 80)
		IS_COLD_CROP_DAMAGE ++
	ENDIF
ENDIF

;梅雨・秋雨時以外に寒冷渦の発生判定
IF !IS_RAINY_SEASON1:0 && !IS_RAINY_SEASON2 && POWER_COLD_AIR == 5
	IS_COLD_LOW = 1
	;寒冷渦の勢力圏突入時刻
	TIME_ENTER_TERRITORY_COLD_LOW:0 = DAY:2
	TIME_ENTER_TERRITORY_COLD_LOW:1 = DAY:3 + RAND:2
	TIME_ENTER_TERRITORY_COLD_LOW:2 = RAND:1440
	
	;寒冷渦の勢力圏通過時刻
	CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_COLD_LOW:0), (TIME_ENTER_TERRITORY_COLD_LOW:1), (TIME_ENTER_TERRITORY_COLD_LOW:2), 2880)
	TIME_PASSAGE_TERRITORY_COLD_LOW:0 = RESULT:0
	TIME_PASSAGE_TERRITORY_COLD_LOW:1 = RESULT:1
	TIME_PASSAGE_TERRITORY_COLD_LOW:2 = RESULT:2
ELSE
	IS_COLD_LOW = 0
	TIME_ENTER_TERRITORY_COLD_LOW:0 = 0
	TIME_ENTER_TERRITORY_COLD_LOW:1 = 0
	TIME_ENTER_TERRITORY_COLD_LOW:2 = 0
ENDIF

;日本海低気圧の消滅判定
IF IS_SoJ_LOW >= 1
	IS_SoJ_LOW = 0
	TIME_ENTER_TERRITORY_SoJ_LOW:0 = 0
	TIME_ENTER_TERRITORY_SoJ_LOW:1 = 0
	TIME_ENTER_TERRITORY_SoJ_LOW:2 = 0
	
	TIME_CLOSEST_SoJ_LOW:0 = 0
	TIME_CLOSEST_SoJ_LOW:1 = 0
	TIME_CLOSEST_SoJ_LOW:2 = 0
	
	TIME_PASSAGE_FAKE_FINE:0 = 0
	TIME_PASSAGE_FAKE_FINE:1 = 0
	TIME_PASSAGE_FAKE_FINE:2 = 0
	
	TIME_PASSAGE_SoJ_LOW:0 = 0
	TIME_PASSAGE_SoJ_LOW:1 = 0
	TIME_PASSAGE_SoJ_LOW:2 = 0
ENDIF

;南岸低気圧の消滅判定
IF IS_SOUTHERN_LOW == 1
	IS_SOUTHERN_LOW = 0
	TIME_ENTER_TERRITORY_SOUTHERN_LOW:0 = 0
	TIME_ENTER_TERRITORY_SOUTHERN_LOW:1 = 0
	TIME_ENTER_TERRITORY_SOUTHERN_LOW:2 = 0
	
	TIME_PASSAGE_SOUTHERN_LOW:0 = 0
	TIME_PASSAGE_SOUTHERN_LOW:1 = 0
	TIME_PASSAGE_SOUTHERN_LOW:2 = 0
ENDIF

;台風の消滅判定
IF (DAY:2 == 1 || (DAY:2 == 3 && NOW_TERM >= 4) || DAY:2 == 4 || TIME_PASSAGE_WIND_ZONE_TYPHOON:0 < DAY:2 || GET_LOCATION_LOW() == "台風一過") && IS_TYPHOON:0 == 1
	IS_TYPHOON:0 = 0
	IS_TYPHOON:1 = 0
	IS_TYPHOON:2 = 0
	IS_TYPHOON:3 = 0
	
	TIME_ENTER_TERRITORY_TYPHOON:0 = 0
	TIME_ENTER_TERRITORY_TYPHOON:1 = 0
	TIME_ENTER_TERRITORY_TYPHOON:2 = 0
	
	TIME_ENTER_WIND_ZONE_TYPHOON:0 = 0
	TIME_ENTER_WIND_ZONE_TYPHOON:1 = 0
	TIME_ENTER_WIND_ZONE_TYPHOON:2 = 0
	
	TIME_CLOSEST_TYPHOON:0 = 0
	TIME_CLOSEST_TYPHOON:1 = 0
	TIME_CLOSEST_TYPHOON:2 = 0
	
	TIME_PASSAGE_EYE_TYPHOON:0 = 0
	TIME_PASSAGE_EYE_TYPHOON:1 = 0
	TIME_PASSAGE_EYE_TYPHOON:2 = 0
	
	TIME_PASSAGE_WIND_ZONE_TYPHOON:0 = 0
	TIME_PASSAGE_WIND_ZONE_TYPHOON:1 = 0
	TIME_PASSAGE_WIND_ZONE_TYPHOON:2 = 0
	
	TIME_ENTER_STORM_AREA_TYPHOON:0 = 0
	TIME_ENTER_STORM_AREA_TYPHOON:1 = 0
	TIME_ENTER_STORM_AREA_TYPHOON:2 = 0
	
	TIME_PASSAGE_STORM_AREA_TYPHOON:0 = 0
	TIME_PASSAGE_STORM_AREA_TYPHOON:1 = 0
	TIME_PASSAGE_STORM_AREA_TYPHOON:2 = 0
	
ENDIF

;台風と寒冷渦が同時に存在するとき迷走台風になる
IF IS_TYPHOON:0 && IS_COLD_LOW
	;台風の強風域通過時刻を延長する
	CALL CALCULATE_ADD_TIME((TIME_PASSAGE_WIND_ZONE_TYPHOON:0), (TIME_PASSAGE_WIND_ZONE_TYPHOON:1), (TIME_PASSAGE_WIND_ZONE_TYPHOON:2), (720 + RAND:360))
	TIME_PASSAGE_WIND_ZONE_TYPHOON:0 = RESULT:0
	TIME_PASSAGE_WIND_ZONE_TYPHOON:1 = RESULT:1
	TIME_PASSAGE_WIND_ZONE_TYPHOON:2 = RESULT:2
	
	;台風の暴風域通過時刻を延長する
	IF IS_TYPHOON:1 >= 3
		CALL CALCULATE_ADD_TIME((TIME_PASSAGE_STORM_AREA_TYPHOON:0), (TIME_PASSAGE_STORM_AREA_TYPHOON:1), (TIME_PASSAGE_STORM_AREA_TYPHOON:2), (720 + RAND:360))
		TIME_PASSAGE_STORM_AREA_TYPHOON:0 = RESULT:0
		TIME_PASSAGE_STORM_AREA_TYPHOON:1 = RESULT:1
		TIME_PASSAGE_STORM_AREA_TYPHOON:2 = RESULT:2
	ENDIF
ENDIF

;夏・秋第1・2ターム時に台風の発生判定
IF (DAY:2 == 2 || (DAY:2 == 3 && NOW_TERM <= 2)) && POWER_WARM_AIR == 5 && !IS_TYPHOON:0
	IS_TYPHOON:0 = 1
	IS_TYPHOON:1 = RAND:5 + 1
	IS_TYPHOON:2 = RAND:3 + 1
	
	;20%の確率で先駆降雨帯発生
	SIF RAND:5 == 0
		IS_TYPHOON:3 = 1
	
	SELECTCASE IS_TYPHOON:2
		CASE 1
			位置倍率 = 7
		CASE 2
			位置倍率 = 10
		CASE 3
			位置倍率 = 9
	ENDSELECT
	
	;台風の勢力圏突入時刻を算定
	CALL CALCULATE_ADD_TERM(DAY:2, NOW_TERM, 1)
	TIME_ENTER_TERRITORY_TYPHOON:0 = RESULT:0
	TIME_ENTER_TERRITORY_TYPHOON:1 = ((RESULT:1 - 1) * 5) + 1
	TIME_ENTER_TERRITORY_TYPHOON:2 = RAND:1440
	
	;台風の強風域突入時刻を算定
	CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_TYPHOON:0), (TIME_ENTER_TERRITORY_TYPHOON:1), (TIME_ENTER_TERRITORY_TYPHOON:2), 2880)
	TIME_ENTER_WIND_ZONE_TYPHOON:0 = RESULT:0
	TIME_ENTER_WIND_ZONE_TYPHOON:1 = RESULT:1
	TIME_ENTER_WIND_ZONE_TYPHOON:2 = RESULT:2
	
	;勢力3以上だと暴風域を備える
	IF IS_TYPHOON:1 >= 3
		;台風の暴風域突入時刻
		CALL CALCULATE_ADD_TIME((TIME_ENTER_WIND_ZONE_TYPHOON:0), (TIME_ENTER_WIND_ZONE_TYPHOON:1), (TIME_ENTER_WIND_ZONE_TYPHOON:2), (360 * 位置倍率 / 10))
		TIME_ENTER_STORM_AREA_TYPHOON:0 = RESULT:0
		TIME_ENTER_STORM_AREA_TYPHOON:1 = RESULT:1
		TIME_ENTER_STORM_AREA_TYPHOON:2 = RESULT:2
		
		;台風の暴風域通過時刻
		CALL CALCULATE_ADD_TIME((TIME_ENTER_WIND_ZONE_TYPHOON:0), (TIME_ENTER_WIND_ZONE_TYPHOON:1), (TIME_ENTER_WIND_ZONE_TYPHOON:2), (1080 * 位置倍率 / 10))
		TIME_PASSAGE_STORM_AREA_TYPHOON:0 = RESULT:0
		TIME_PASSAGE_STORM_AREA_TYPHOON:1 = RESULT:1
		TIME_PASSAGE_STORM_AREA_TYPHOON:2 = RESULT:2
	ENDIF
	
	;台風の最接近時刻を算定
	CALL CALCULATE_ADD_TIME((TIME_ENTER_WIND_ZONE_TYPHOON:0), (TIME_ENTER_WIND_ZONE_TYPHOON:1), (TIME_ENTER_WIND_ZONE_TYPHOON:2), (720 * 位置倍率 / 10))
	TIME_CLOSEST_TYPHOON:0 = RESULT:0
	TIME_CLOSEST_TYPHOON:1 = RESULT:1
	TIME_CLOSEST_TYPHOON:2 = RESULT:2
	
	;台風の目通過時刻を算定
	CALL CALCULATE_ADD_TIME((TIME_CLOSEST_TYPHOON:0), (TIME_CLOSEST_TYPHOON:1), (TIME_CLOSEST_TYPHOON:2), (10 * IS_TYPHOON:1))
	TIME_PASSAGE_EYE_TYPHOON:0 = RESULT:0
	TIME_PASSAGE_EYE_TYPHOON:1 = RESULT:1
	TIME_PASSAGE_EYE_TYPHOON:2 = RESULT:2
	
	;台風の強風域通過時刻を算定
	CALL CALCULATE_ADD_TIME((TIME_ENTER_WIND_ZONE_TYPHOON:0), (TIME_ENTER_WIND_ZONE_TYPHOON:1), (TIME_ENTER_WIND_ZONE_TYPHOON:2), (1420 * 位置倍率 / 10))
	TIME_PASSAGE_WIND_ZONE_TYPHOON:0 = RESULT:0
	TIME_PASSAGE_WIND_ZONE_TYPHOON:1 = RESULT:1
	TIME_PASSAGE_WIND_ZONE_TYPHOON:2 = RESULT:2
ENDIF

;冬に温帯低気圧の発生判定
IF DAY:2 == 4 && !IS_COLD_LOW
	日本海低気圧発生判定 = RAND:5
	南岸低気圧発生判定 = RAND:5
	
	;二つ玉低気圧発生
	IF !日本海低気圧発生判定 && !南岸低気圧発生判定
		IS_SoJ_LOW = 2
		;日本海低気圧の勢力圏突入時刻
		TIME_ENTER_TERRITORY_SoJ_LOW:0 = DAY:2
		TIME_ENTER_TERRITORY_SoJ_LOW:1 = DAY:3 + RAND:3
		TIME_ENTER_TERRITORY_SoJ_LOW:2 = RAND:1440
		
		;日本海低気圧の最接近時刻
		CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_SoJ_LOW:0), (TIME_ENTER_TERRITORY_SoJ_LOW:1), (TIME_ENTER_TERRITORY_SoJ_LOW:2), 720)
		TIME_CLOSEST_SoJ_LOW:0 = RESULT:0
		TIME_CLOSEST_SoJ_LOW:1 = RESULT:1
		TIME_CLOSEST_SoJ_LOW:2 = RESULT:2
		
		;疑似好天エリア通過時刻
		CALL CALCULATE_ADD_TIME((TIME_CLOSEST_SoJ_LOW:0), (TIME_CLOSEST_SoJ_LOW:1), (TIME_CLOSEST_SoJ_LOW:2), (30 * (RAND:6 + 1)))
		TIME_PASSAGE_FAKE_FINE:0 = RESULT:0
		TIME_PASSAGE_FAKE_FINE:1 = RESULT:1
		TIME_PASSAGE_FAKE_FINE:2 = RESULT:2
		
		;日本海低気圧の通過時刻
		CALL CALCULATE_ADD_TIME((TIME_CLOSEST_SoJ_LOW:0), (TIME_CLOSEST_SoJ_LOW:1), (TIME_CLOSEST_SoJ_LOW:2), 1080)
		TIME_PASSAGE_SoJ_LOW:0 = RESULT:0
		TIME_PASSAGE_SoJ_LOW:1 = RESULT:1
		TIME_PASSAGE_SoJ_LOW:2 = RESULT:2
		
	;日本海低気圧発生
	ELSEIF !日本海低気圧発生判定
		IS_SoJ_LOW = 1
		;日本海低気圧の勢力圏突入時刻
		TIME_ENTER_TERRITORY_SoJ_LOW:0 = DAY:2
		TIME_ENTER_TERRITORY_SoJ_LOW:1 = DAY:3 + RAND:3
		TIME_ENTER_TERRITORY_SoJ_LOW:2 = RAND:1440
		
		;日本海低気圧の最接近時刻
		CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_SoJ_LOW:0), (TIME_ENTER_TERRITORY_SoJ_LOW:1), (TIME_ENTER_TERRITORY_SoJ_LOW:2), 720)
		TIME_CLOSEST_SoJ_LOW:0 = RESULT:0
		TIME_CLOSEST_SoJ_LOW:1 = RESULT:1
		TIME_CLOSEST_SoJ_LOW:2 = RESULT:2
		
		;日本海低気圧の通過時刻
		CALL CALCULATE_ADD_TIME((TIME_CLOSEST_SoJ_LOW:0), (TIME_CLOSEST_SoJ_LOW:1), (TIME_CLOSEST_SoJ_LOW:2), 1080)
		TIME_PASSAGE_SoJ_LOW:0 = RESULT:0
		TIME_PASSAGE_SoJ_LOW:1 = RESULT:1
		TIME_PASSAGE_SoJ_LOW:2 = RESULT:2
		
	;南岸低気圧発生
	ELSEIF !南岸低気圧発生判定
		IS_SOUTHERN_LOW = 1
		;南岸低気圧の勢力圏突入時刻
		TIME_ENTER_TERRITORY_SOUTHERN_LOW:0 = DAY:2
		TIME_ENTER_TERRITORY_SOUTHERN_LOW:1 = DAY:3 + RAND:3
		TIME_ENTER_TERRITORY_SOUTHERN_LOW:2 = RAND:1440
		
		;南岸低気圧の通過時刻
		CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_SOUTHERN_LOW:0), (TIME_ENTER_TERRITORY_SOUTHERN_LOW:1), (TIME_ENTER_TERRITORY_SOUTHERN_LOW:2), 1440)
		TIME_PASSAGE_SOUTHERN_LOW:0 = RESULT:0
		TIME_PASSAGE_SOUTHERN_LOW:1 = RESULT:1
		TIME_PASSAGE_SOUTHERN_LOW:2 = RESULT:2
	ENDIF
ENDIF

;春・秋に温暖低気圧の発生判定
IF (DAY:2 == 1 || DAY:2 == 3) && !IS_COLD_LOW && !IS_RAINY_SEASON1:0 && !IS_RAINY_SEASON2
	;春・秋の温帯低気圧の勢力圏突入時刻
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0 = DAY:2
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:1 = DAY:3 + 1 + RAND:2
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:2 = RAND:1440
	
	;春・秋の温帯低気圧の温暖前線通過時刻
	CALL CALCULATE_ADD_TIME((TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0), (TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:1), (TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:2), 1440)
	TIME_PASSAGE_WARM_FRONT:0 = RESULT:0
	TIME_PASSAGE_WARM_FRONT:1 = RESULT:1
	TIME_PASSAGE_WARM_FRONT:2 = RESULT:2
	
	;春・秋の温帯低気圧の寒冷前線時刻
	CALL CALCULATE_ADD_TIME((TIME_PASSAGE_WARM_FRONT:0), (TIME_PASSAGE_WARM_FRONT:1), (TIME_PASSAGE_WARM_FRONT:2), 720)
	TIME_PASSAGE_COLD_FRONT:0 = RESULT:0
	TIME_PASSAGE_COLD_FRONT:1 = RESULT:1
	TIME_PASSAGE_COLD_FRONT:2 = RESULT:2
	
	;春・秋の温帯低気圧の勢力圏通過時刻
	CALL CALCULATE_ADD_TIME((TIME_PASSAGE_COLD_FRONT:0), (TIME_PASSAGE_COLD_FRONT:1), (TIME_PASSAGE_COLD_FRONT:2), 180)
	TIME_PASSAGE_EXTRATROPICAL_LOW:0 = RESULT:0
	TIME_PASSAGE_EXTRATROPICAL_LOW:1 = RESULT:1
	TIME_PASSAGE_EXTRATROPICAL_LOW:2 = RESULT:2
;温帯低気圧の消滅判定
ELSE
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0 = 0
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:1 = 0
	TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:2 = 0
	
	TIME_PASSAGE_WARM_FRONT:0 = 0
	TIME_PASSAGE_WARM_FRONT:1 = 0
	TIME_PASSAGE_WARM_FRONT:2 = 0
	
	TIME_PASSAGE_COLD_FRONT:0 = 0
	TIME_PASSAGE_COLD_FRONT:1 = 0
	TIME_PASSAGE_COLD_FRONT:2 = 0
	
	TIME_PASSAGE_EXTRATROPICAL_LOW:0 = 0
	TIME_PASSAGE_EXTRATROPICAL_LOW:1 = 0
	TIME_PASSAGE_EXTRATROPICAL_LOW:2 = 0
ENDIF
;-------------------------------------------------
;1日予報
;-------------------------------------------------
@WEATHER_FORECAST_1DAY

;天候変更禁止を解除する
FORBIDDEN_CHANGE_WEATHER = 0

;霧発生フラグをリセット
CAN_STRATUS = 0

;霧の発生判定
SIF !IS_COLD_LOW && !IS_TYPHOON:0 && !IS_SoJ_LOW && !IS_SOUTHERN_LOW && !RAND:10
	CAN_STRATUS = 1

;積雲/積乱雲の発生判定
IF DAY:2 == 2 && POWER_WARM_AIR >= 2 && !IS_COLD_LOW && (GET_LOCATION_LOW() == "台風遠方" || GET_LOCATION_LOW() == "台風一過" || GET_LOCATION_LOW() == "低気圧未発生")
	SELECTCASE POWER_WARM_AIR
		CASE 2, 3
			SELECTCASE RAND:(POWER_WARM_AIR)
				CASE 0
					CAN_CUMULUS:0 = 1
				CASEELSE
					CAN_CUMULUS:0 = 2
			ENDSELECT
		CASE 4, 5
			SELECTCASE RAND:(POWER_WARM_AIR)
				CASE 0
					CAN_CUMULUS:0 = 1
				CASE 1
					CAN_CUMULUS:0 = 2
				CASEELSE
					CAN_CUMULUS:0 = 3
			ENDSELECT
	ENDSELECT
	SIF !RAND:4
		CAN_CUMULUS:1 = 1
ELSEIF DAY:2 == 2 && (IS_COLD_LOW || GET_LOCATION_LOW() == "台風勢力圏")
	SELECTCASE POWER_WARM_AIR
		CASE 1, 2
			SELECTCASE RAND:(POWER_WARM_AIR)
				CASE 0
					CAN_CUMULUS:0 = 2
				CASEELSE
					CAN_CUMULUS:0 = 3
			ENDSELECT
			SIF !RAND:4
				CAN_CUMULUS:1 = 1
		CASE 3, 4
			SELECTCASE RAND:(POWER_WARM_AIR)
				CASE 0
					CAN_CUMULUS:0 = 3
				CASEELSE
					CAN_CUMULUS:0 = 4
			ENDSELECT
			SIF !RAND:2
				CAN_CUMULUS:1 = 1
		CASE 5
			SELECTCASE RAND:20
				CASE 0
					CAN_CUMULUS:0 = 5
				CASEELSE
					CAN_CUMULUS:0 = 4
			ENDSELECT
			CAN_CUMULUS:1 = 1
	ENDSELECT
;積雲/積乱雲の発生判定をリセット
ELSE
	CAN_CUMULUS:0 = 0
	CAN_CUMULUS:1 = 0
	CAN_CUMULUS:2 = 0
	TIME_ENTER_TERRITORY_CUMULUS = 0
	TIME_CLOSEST_CUMULUS = 0
ENDIF

IF CAN_CUMULUS:1 == 1
	;積雲/積乱雲の勢力圏突入時刻
	TIME_ENTER_TERRITORY_CUMULUS = 840 + RAND:120
	
	;積雲/積乱雲の最接近時刻
	TIME_CLOSEST_CUMULUS = TIME_ENTER_TERRITORY_CUMULUS + 15 + RAND:15
	
	;積雲/積乱雲の勢力圏通過時刻
	SELECTCASE CAN_CUMULUS:0
		CASE IS <= 3
			TIME_PASSAGE_CUMULUS = TIME_CLOSEST_CUMULUS + 30 + RAND:15
		CASE 4
			TIME_PASSAGE_CUMULUS = TIME_CLOSEST_CUMULUS + 60  + (RAND:2 * 60) + RAND:30
		CASE 5
			TIME_PASSAGE_CUMULUS = TIME_CLOSEST_CUMULUS + 60  + (RAND:3 * 60) + RAND:30
	ENDSELECT
ENDIF

;かなとこ雲とスーパーセルの場合風の強さ判定
IF CAN_CUMULUS:0 == 4 && CAN_CUMULUS:1 == 1
	IF RAND:50 == 0
		CAN_CUMULUS:2 = 2
	ELSE
		CAN_CUMULUS:2 = 1
	ENDIF
ELSEIF CAN_CUMULUS:0 == 5 && CAN_CUMULUS:1 == 1
	IF RAND:10 == 0
		CAN_CUMULUS:2 = 2
	ELSE
		CAN_CUMULUS:2 = 1
	ENDIF
ENDIF

;-------------------------------------------------
;低気圧の位置判定
;-------------------------------------------------
@GET_LOCATION_LOW
#FUNCTIONS

;台風
IF IS_TYPHOON:0
	;台風の勢力圏突入時刻以前
	IF TIME_ENTER_TERRITORY_TYPHOON:0 > DAY:2
		RETURNF "台風遠方"
	ELSEIF TIME_ENTER_TERRITORY_TYPHOON:0 == DAY:2 && TIME_ENTER_TERRITORY_TYPHOON:1 > DAY:3
		RETURNF "台風遠方"
	ELSEIF TIME_ENTER_TERRITORY_TYPHOON:0 == DAY:2 && TIME_ENTER_TERRITORY_TYPHOON:1 == DAY:3 && TIME_ENTER_TERRITORY_TYPHOON:2 > TIME:0
		RETURNF "台風遠方"
	;台風の強風域突入時刻以前
	ELSEIF TIME_ENTER_WIND_ZONE_TYPHOON:0 > DAY:2
		RETURNF "台風勢力圏"
	ELSEIF TIME_ENTER_WIND_ZONE_TYPHOON:0 == DAY:2 && TIME_ENTER_WIND_ZONE_TYPHOON:1 > DAY:3
		RETURNF "台風勢力圏"
	ELSEIF TIME_ENTER_WIND_ZONE_TYPHOON:0 == DAY:2 && TIME_ENTER_WIND_ZONE_TYPHOON:1 == DAY:3 && TIME_ENTER_WIND_ZONE_TYPHOON:2 > TIME:0
		RETURNF "台風勢力圏"
	;台風に暴風域があり台風の暴風域突入時刻以前
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_ENTER_STORM_AREA_TYPHOON:0 > DAY:2
		RETURNF "台風接近強風域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_ENTER_STORM_AREA_TYPHOON:0 == DAY:2 && TIME_ENTER_STORM_AREA_TYPHOON:1 > DAY:3
		RETURNF "台風接近強風域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_ENTER_STORM_AREA_TYPHOON:0 == DAY:2 && TIME_ENTER_STORM_AREA_TYPHOON:1 == DAY:3 && TIME_ENTER_STORM_AREA_TYPHOON:2 > TIME:0
		RETURNF "台風接近強風域"
	;台風に暴風域がなく台風の最接近時刻以前
	ELSEIF IS_TYPHOON:1 < 3 && TIME_CLOSEST_TYPHOON:0 > DAY:2
		RETURNF "台風接近強風域"
	ELSEIF IS_TYPHOON:1 < 3 && TIME_CLOSEST_TYPHOON:0 == DAY:2 && TIME_CLOSEST_TYPHOON:1 > DAY:3
		RETURNF "台風接近強風域"
	ELSEIF IS_TYPHOON:1 < 3 && TIME_CLOSEST_TYPHOON:0 == DAY:2 && TIME_CLOSEST_TYPHOON:1 == DAY:3 && TIME_CLOSEST_TYPHOON:2 > TIME:0
		RETURNF "台風接近強風域"
	;台風に暴風域があり台風の最接近時刻以前
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_CLOSEST_TYPHOON:0 > DAY:2
		RETURNF "台風接近暴風域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_CLOSEST_TYPHOON:0 == DAY:2 && TIME_CLOSEST_TYPHOON:1 > DAY:3
		RETURNF "台風接近暴風域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_CLOSEST_TYPHOON:0 == DAY:2 && TIME_CLOSEST_TYPHOON:1 == DAY:3 && TIME_CLOSEST_TYPHOON:2 > TIME:0
		RETURNF "台風接近暴風域"
	;台風の目通過時刻以前
	ELSEIF TIME_PASSAGE_EYE_TYPHOON:0 > DAY:2
		RETURNF "台風最接近"
	ELSEIF TIME_PASSAGE_EYE_TYPHOON:0 == DAY:2 && TIME_PASSAGE_EYE_TYPHOON:1 > DAY:3
		RETURNF "台風最接近"
	ELSEIF TIME_PASSAGE_EYE_TYPHOON:0 == DAY:2 && TIME_PASSAGE_EYE_TYPHOON:1 == DAY:3 && TIME_PASSAGE_EYE_TYPHOON:2 > TIME:0
		RETURNF "台風最接近"
	;台風に暴風域があり暴風域通過時刻以前
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_PASSAGE_STORM_AREA_TYPHOON:0 > DAY:2
		RETURNF "台風通過暴風域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_PASSAGE_STORM_AREA_TYPHOON:0 == DAY:2 && TIME_PASSAGE_STORM_AREA_TYPHOON:1 > DAY:3
		RETURNF "台風通過暴風域"
	ELSEIF IS_TYPHOON:1 >= 3 && TIME_PASSAGE_STORM_AREA_TYPHOON:0 == DAY:2 && TIME_PASSAGE_STORM_AREA_TYPHOON:1 == DAY:3 && TIME_PASSAGE_STORM_AREA_TYPHOON:2 > TIME:0
		RETURNF "台風通過暴風域"
	;台風の強風域通過時刻以前
	ELSEIF TIME_PASSAGE_WIND_ZONE_TYPHOON:0 > DAY:2
		RETURNF "台風通過強風域"
	ELSEIF TIME_PASSAGE_WIND_ZONE_TYPHOON:0 == DAY:2 && TIME_PASSAGE_WIND_ZONE_TYPHOON:1 > DAY:3
		RETURNF "台風通過強風域"
	ELSEIF TIME_PASSAGE_WIND_ZONE_TYPHOON:0 == DAY:2 && TIME_PASSAGE_WIND_ZONE_TYPHOON:1 == DAY:3 && TIME_PASSAGE_WIND_ZONE_TYPHOON:2 > TIME:0
		RETURNF "台風通過強風域"
	ELSE
		RETURNF "台風一過"
	ENDIF
;寒冷渦
ELSEIF IS_COLD_LOW
	;寒冷渦の勢力圏突入時刻以前
	IF TIME_ENTER_TERRITORY_COLD_LOW:0 > DAY:2
		RETURNF "寒冷渦遠方"
	ELSEIF TIME_ENTER_TERRITORY_COLD_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_COLD_LOW:1 > DAY:3
		RETURNF "寒冷渦遠方"
	ELSEIF TIME_ENTER_TERRITORY_COLD_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_COLD_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_COLD_LOW:2 > TIME:0
		RETURNF "寒冷渦遠方"
	;寒冷渦の勢力圏通過時刻以前
	ELSEIF TIME_PASSAGE_TERRITORY_COLD_LOW:0 > DAY:2
		RETURNF "寒冷渦接近"
	ELSEIF TIME_PASSAGE_TERRITORY_COLD_LOW:0 == DAY:2 && TIME_PASSAGE_TERRITORY_COLD_LOW:1 > DAY:3
		RETURNF "寒冷渦接近"
	ELSEIF TIME_PASSAGE_TERRITORY_COLD_LOW:0 == DAY:2 && TIME_PASSAGE_TERRITORY_COLD_LOW:1 == DAY:3 && TIME_PASSAGE_TERRITORY_COLD_LOW:2 > TIME:0
		RETURNF "寒冷渦接近"
	ELSE
		RETURNF "寒冷渦通過"
	ENDIF
;二つ玉低気圧
ELSEIF IS_SoJ_LOW == 2
	;二つ玉低気圧の勢力圏突入時刻以前
	IF TIME_ENTER_TERRITORY_SoJ_LOW:0 > DAY:2
		RETURNF "二つ玉低気圧遠方"
	ELSEIF TIME_ENTER_TERRITORY_SoJ_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SoJ_LOW:1 > DAY:3
		RETURNF "二つ玉低気圧遠方"
	ELSEIF TIME_ENTER_TERRITORY_SoJ_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SoJ_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_SoJ_LOW:2 > TIME:0
		RETURNF "二つ玉低気圧遠方"
	;二つ玉低気圧の最接近時刻以前
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 > DAY:2
		RETURNF "二つ玉低気圧接近"
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 == DAY:2 && TIME_CLOSEST_SoJ_LOW:1 > DAY:3
		RETURNF "二つ玉低気圧接近"
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 == DAY:2 && TIME_CLOSEST_SoJ_LOW:1 == DAY:3 && TIME_CLOSEST_SoJ_LOW:2 > TIME:0
		RETURNF "二つ玉低気圧接近"
	;疑似好天エリア通過時刻以前
	ELSEIF TIME_PASSAGE_FAKE_FINE:0 > DAY:2
		RETURNF "疑似好天"
	ELSEIF TIME_PASSAGE_FAKE_FINE:0 == DAY:2 && TIME_PASSAGE_FAKE_FINE:1 > DAY:3
		RETURNF "疑似好天"
	ELSEIF TIME_PASSAGE_FAKE_FINE:0 == DAY:2 && TIME_PASSAGE_FAKE_FINE:1 == DAY:3 && TIME_PASSAGE_FAKE_FINE:2 > TIME:0
		RETURNF "疑似好天"
	;二つ玉低気圧の通過時刻以前
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 > DAY:2
		RETURNF "二つ玉低気圧通過中"
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 == DAY:2 && TIME_PASSAGE_SoJ_LOW:1 > DAY:3
		RETURNF "二つ玉低気圧通過中"
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 == DAY:2 && TIME_PASSAGE_SoJ_LOW:1 == DAY:3 && TIME_PASSAGE_SoJ_LOW:2 > TIME:0
		RETURNF "二つ玉低気圧通過中"
	ELSE
		RETURNF "二つ玉低気圧通過"
	ENDIF
;日本海低気圧
ELSEIF IS_SoJ_LOW == 1
	;日本海低気圧の勢力圏突入時刻以前
	IF TIME_ENTER_TERRITORY_SoJ_LOW:0 > DAY:2
		RETURNF "日本海低気圧遠方"
	ELSEIF TIME_ENTER_TERRITORY_SoJ_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SoJ_LOW:1 > DAY:3
		RETURNF "日本海低気圧遠方"
	ELSEIF TIME_ENTER_TERRITORY_SoJ_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SoJ_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_SoJ_LOW:2 > TIME:0
		RETURNF "日本海低気圧遠方"
	;日本海低気圧の最接近時刻以前
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 > DAY:2
		RETURNF "日本海低気圧接近"
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 == DAY:2 && TIME_CLOSEST_SoJ_LOW:1 > DAY:3
		RETURNF "日本海低気圧接近"
	ELSEIF TIME_CLOSEST_SoJ_LOW:0 == DAY:2 && TIME_CLOSEST_SoJ_LOW:1 == DAY:3 && TIME_CLOSEST_SoJ_LOW:2 > TIME:0
		RETURNF "日本海低気圧接近"
	;日本海低気圧の通過時刻以前
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 > DAY:2
		RETURNF "日本海低気圧通過中"
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 == DAY:2 && TIME_PASSAGE_SoJ_LOW:1 > DAY:3
		RETURNF "日本海低気圧通過中"
	ELSEIF TIME_PASSAGE_SoJ_LOW:0 == DAY:2 && TIME_PASSAGE_SoJ_LOW:1 == DAY:3 && TIME_PASSAGE_SoJ_LOW:2 > TIME:0
		RETURNF "日本海低気圧通過中"
	ELSE
		RETURNF "日本海低気圧通過"
	ENDIF
;南岸低気圧
ELSEIF IS_SOUTHERN_LOW
	;南岸低気圧の勢力圏突入時刻以前
	IF TIME_ENTER_TERRITORY_SOUTHERN_LOW:0 > DAY:2
		RETURNF "南岸低気圧遠方"
	ELSEIF TIME_ENTER_TERRITORY_SOUTHERN_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SOUTHERN_LOW:1 > DAY:3
		RETURNF "南岸低気圧遠方"
	ELSEIF TIME_ENTER_TERRITORY_SOUTHERN_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_SOUTHERN_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_SOUTHERN_LOW:2 > TIME:0
		RETURNF "南岸低気圧遠方"
	;南岸低気圧の通過時刻以前
	ELSEIF TIME_PASSAGE_SOUTHERN_LOW:0 > DAY:2
		RETURNF "南岸低気圧接近"
	ELSEIF TIME_PASSAGE_SOUTHERN_LOW:0 == DAY:2 && TIME_PASSAGE_SOUTHERN_LOW:1 > DAY:3
		RETURNF "南岸低気圧接近"
	ELSEIF TIME_PASSAGE_SOUTHERN_LOW:0 == DAY:2 && TIME_PASSAGE_SOUTHERN_LOW:1 == DAY:3 && TIME_PASSAGE_SOUTHERN_LOW:2 > TIME:0
		RETURNF "南岸低気圧接近"
	ELSE
		RETURNF "南岸低気圧通過"
	ENDIF
;春・秋の温帯低気圧
ELSEIF (DAY:2 == 1 || DAY:2 == 3) && !IS_RAINY_SEASON1 && !IS_RAINY_SEASON2
	;温暖前線の勢力圏突入時刻以前
	IF TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0 > DAY:2
		RETURNF "温暖前線遠方"
	ELSEIF TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:1 > DAY:3
		RETURNF "温暖前線遠方"
	ELSEIF TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:0 == DAY:2 && TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:1 == DAY:3 && TIME_ENTER_TERRITORY_EXTRATROPICAL_LOW:2 > TIME:0
		RETURNF "温暖前線遠方"
	;温暖前線通過時刻以前
	ELSEIF TIME_PASSAGE_WARM_FRONT:0 > DAY:2
		RETURNF "温暖前線接近"
	ELSEIF TIME_PASSAGE_WARM_FRONT:0 == DAY:2 && TIME_PASSAGE_WARM_FRONT:1 > DAY:3
		RETURNF "温暖前線接近"
	ELSEIF TIME_PASSAGE_WARM_FRONT:0 == DAY:2 && TIME_PASSAGE_WARM_FRONT:1 == DAY:3 && TIME_PASSAGE_WARM_FRONT:2 > TIME:0
		RETURNF "温暖前線接近"
	;寒冷前線通過時刻以前
	ELSEIF TIME_PASSAGE_COLD_FRONT:0 > DAY:2
		RETURNF "暖域"
	ELSEIF TIME_PASSAGE_COLD_FRONT:0 == DAY:2 && TIME_PASSAGE_COLD_FRONT:1 > DAY:3
		RETURNF "暖域"
	ELSEIF TIME_PASSAGE_COLD_FRONT:0 == DAY:2 && TIME_PASSAGE_COLD_FRONT:1 == DAY:3 && TIME_PASSAGE_COLD_FRONT:2 > TIME:0
		RETURNF "暖域"
	;温帯低気圧の勢力圏通過時刻以前
	ELSEIF TIME_PASSAGE_EXTRATROPICAL_LOW:0 > DAY:2
		RETURNF "寒冷前線通過"
	ELSEIF TIME_PASSAGE_EXTRATROPICAL_LOW:0 == DAY:2 && TIME_PASSAGE_EXTRATROPICAL_LOW:1 > DAY:3
		RETURNF "寒冷前線通過"
	ELSEIF TIME_PASSAGE_EXTRATROPICAL_LOW:0 == DAY:2 && TIME_PASSAGE_EXTRATROPICAL_LOW:1 == DAY:3 && TIME_PASSAGE_EXTRATROPICAL_LOW:2 > TIME:0
		RETURNF "寒冷前線通過"
	ELSE
		RETURNF "温帯低気圧通過"
	ENDIF
ENDIF

RETURNF "低気圧未発生"

;-------------------------------------------------
;積雲/積乱雲の位置判定
;-------------------------------------------------
@GET_LOCATION_CUMULUS
#FUNCTIONS

IF CAN_CUMULUS:0 && CAN_CUMULUS:1
	IF TIME_ENTER_TERRITORY_CUMULUS > TIME:0
		RETURNF "積乱雲視認"
	ELSEIF TIME_CLOSEST_CUMULUS > TIME:0
		RETURNF "積乱雲接近"
	ELSEIF TIME_PASSAGE_CUMULUS > TIME:0
		RETURNF "積乱雲直下"
	ELSE
		RETURNF "積乱雲通過"
	ENDIF
ELSE
	RETURNF "積乱雲遠方"
ENDIF

RETURNF "積乱雲未発生"

;-------------------------------------------------
;台風の襲来判定
;-------------------------------------------------
@GET_LOCATION_AREA_TYPHOON
#FUNCTION
#DIMS 低気圧位置

低気圧位置 = %GET_LOCATION_LOW()%

SIF 低気圧位置 == "台風接近強風域" || 低気圧位置 == "台風接近暴風域" || 低気圧位置 == "台風最接近" || 低気圧位置 == "台風通過暴風域" || 低気圧位置 == "台風通過強風域"
	RETURNF 1

RETURNF 0

